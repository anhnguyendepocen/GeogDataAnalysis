<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>Exercise 7</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/clipboard-1.7.1/clipboard.min.js"></script>
<link href="site_libs/primer-tooltips-1.4.0/build.css" rel="stylesheet" />
<link href="site_libs/klippy-0.0.0.9500/css/klippy.min.css" rel="stylesheet" />
<script src="site_libs/klippy-0.0.0.9500/js/klippy.min.js"></script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #0000ff; } /* Keyword */
code > span.ch { color: #008080; } /* Char */
code > span.st { color: #008080; } /* String */
code > span.co { color: #008000; } /* Comment */
code > span.ot { color: #ff4000; } /* Other */
code > span.al { color: #ff0000; } /* Alert */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #008000; font-weight: bold; } /* Warning */
code > span.cn { } /* Constant */
code > span.sc { color: #008080; } /* SpecialChar */
code > span.vs { color: #008080; } /* VerbatimString */
code > span.ss { color: #008080; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { } /* Variable */
code > span.cf { color: #0000ff; } /* ControlFlow */
code > span.op { } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #ff4000; } /* Preprocessor */
code > span.do { color: #008000; } /* Documentation */
code > span.an { color: #008000; } /* Annotation */
code > span.cv { color: #008000; } /* CommentVar */
code > span.at { } /* Attribute */
code > span.in { color: #008000; } /* Information */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' || rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="html-md-01.css" type="text/css" />

</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<div class="container-fluid main-container">

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->





<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Geographic Data Analysis</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="overview.html">Overview</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Topics
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Lecture topics</li>
    <li>
      <a href="lec01.html">Introduction to the course</a>
    </li>
    <li>
      <a href="lec02.html">Univariate plots</a>
    </li>
    <li>
      <a href="lec03.html">Bivariate plots</a>
    </li>
    <li>
      <a href="ggplot2.html">ggplot2 versions of basic plots</a>
    </li>
    <li>
      <a href="lec04.html">Descriptive statistics</a>
    </li>
    <li>
      <a href="lec05.html">Multivariate plots</a>
    </li>
    <li>
      <a href="lec06.html">Maps in R</a>
    </li>
    <li>
      <a href="lec07.html">Geospatial analysis in R</a>
    </li>
    <li>
      <a href="lec08.html">Data wrangling and matrix algebra</a>
    </li>
    <li>
      <a href="lec09.html">Reference distributions</a>
    </li>
    <li>
      <a href="lec10.html">Statistical inference</a>
    </li>
    <li>
      <a href="lec11.html">Analysis of variance</a>
    </li>
    <li>
      <a href="lec12.html">Regression analysis</a>
    </li>
    <li>
      <a href="lec13.html">More regression analysis</a>
    </li>
    <li>
      <a href="lec14.html">Nonparametric regression</a>
    </li>
    <li>
      <a href="lec15.html">GLMs, GAMs, and CARTs</a>
    </li>
    <li>
      <a href="lec16.html">Principal components and factor analyses</a>
    </li>
    <li>
      <a href="lec17.html">MANOVA and discriminant analysis</a>
    </li>
    <li>
      <a href="lec18.html">Multivariate distances and cluster analysis</a>
    </li>
    <li>
      <a href="lec19.html">High-resolution and high-dimension data</a>
    </li>
    <li>
      <a href="lec20.html">Analysis and visualization of large raster data sets</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Exercises &amp; Exams
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Exercises</li>
    <li>
      <a href="ex01.html">Exercise 01 -- Getting R and RStudio</a>
    </li>
    <li>
      <a href="ex02.html">Exercise 02 -- Univariate plots</a>
    </li>
    <li>
      <a href="ex03.html">Exercise 03 -- Bivariate plots and descriptive statistics</a>
    </li>
    <li>
      <a href="ex04.html">Exercise 04 -- Multivariate plots</a>
    </li>
    <li>
      <a href="ex05.html">Exercise 05 -- Data wrangling and matrix algebra</a>
    </li>
    <li>
      <a href="ex06.html">Exercise 06 -- CI's, t-tests, ANOVA</a>
    </li>
    <li>
      <a href="ex07.html">Exercise 07 -- Regression analysis</a>
    </li>
    <li>
      <a href="ex08.html">Exercise 08 -- Multivariate analysis</a>
    </li>
    <li class="dropdown-header">Exams</li>
    <li>
      <a href="exam1.html">Exam 1</a>
    </li>
    <li>
      <a href="exam2.html">Exam 2</a>
    </li>
    <li class="dropdown-header">Other materials</li>
    <li>
      <a href="packages-and-data.html">Packages and Data</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Resources
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="readings.html">Readings</a>
    </li>
    <li>
      <a href="datasets.html">Datasets</a>
    </li>
    <li>
      <a href="oldpages.html">Old course web pages</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="about.html">About</a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Exercise 7</h1>

</div>


<script>
  addClassKlippyTo("pre.r, pre.markdown");
  addKlippy('right', 'top', 'auto', '1', 'Copy code', 'Copied!');
</script>
<p><strong>Geography 4/595: Geographic Data Analysis</strong><br />
<strong>Winter 2019</strong></p>
<p><strong>Exercise 7: Regression Analysis</strong><br />
<strong>Finish by Monday, March 4th</strong></p>
<p><strong>1. Introduction</strong></p>
<p>The objective of this exercise is to illustrate regression analysis as well as multivariate plotting, which will be used to examine the data set that will be used in the regression analysis. The focus of the exercise is on the relationship between annual mean temperature at climate stations in Oregon and elevation and location as expressed by latitude and longitude. The specific goal will be to build a regression model that fits the response-variable data well, and does not suffer from assumption violations.</p>
<p>Here’s a link to a .csv file containing the data: <a href="https://pjbartlein.github.io/GeogDataAnalysis/data/csv/ortann.csv">[ortann.csv]</a>.</p>
<p>And here are links to the components of the Oregon county outline shape files: <a href="https://pjbartlein.github.io/GeogDataAnalysis/data/shp/orotl.shp">[orotl.shp]</a> <a href="https://pjbartlein.github.io/GeogDataAnalysis/data/shp/orotl.dbf">[orotl.dbf]</a> <a href="https://pjbartlein.github.io/GeogDataAnalysis/data/shp/orotl.shx">[orotl.shx]</a></p>
<p>Read in the .csv file and the shapefile components if they are not already in the workspace.</p>
<p><strong>2. Maps and scatter plots</strong></p>
<p>The exercise will involve fitting a succession of models, the “goodness-of-fit” of which can be viewed by examining the patterns in maps of the residuals. These should show progressively less obvious patterns as the fit improves.</p>
<p>The first step in any regression analysis (or for that matter ANY analysis) is to look at the data. In the example below, the dependent or response variable will be annual temperature at the Oregon climate stations, and the predictors will be elevation and location (latitude and longitude). A quick way to get scatter plots is to produce a matrix plot</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">attach</span>(ortann)
<span class="kw">plot</span>(ortann[,<span class="dv">2</span><span class="op">:</span><span class="dv">5</span>])</code></pre></div>
<p>The square bracket selection omits the first column of the <code>ortann</code> data frame from the plot (which contains the station names).</p>
<p>To continue, the following script will produce some maps of the data:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># load some packages</span>
<span class="kw">library</span>(maptools)
<span class="kw">library</span>(RColorBrewer)
<span class="kw">library</span>(classInt)

<span class="co"># Set plotting variable and get colors</span>
plottitle &lt;-<span class="st"> &quot;Annual Temperature (C)&quot;</span>
varname &lt;-<span class="st"> &quot;tann&quot;</span> <span class="co"># name of variable to plot</span>
plotvar &lt;-<span class="st"> </span>tann <span class="co"># assignment of variable to plotvar</span>
nclr &lt;-<span class="st"> </span><span class="dv">8</span> <span class="co"># number of colors</span>
plotclr &lt;-<span class="st"> </span><span class="kw">brewer.pal</span>(nclr,<span class="st">&quot;PuOr&quot;</span>)
plotclr &lt;-<span class="st"> </span>plotclr[nclr<span class="op">:</span><span class="dv">1</span>] <span class="co"># reorder colors</span>
class &lt;-<span class="st"> </span><span class="kw">classIntervals</span>(plotvar, nclr, <span class="dt">style=</span><span class="st">&quot;quantile&quot;</span>)
colcode &lt;-<span class="st"> </span><span class="kw">findColours</span>(class, plotclr)
cutpts &lt;-<span class="st"> </span><span class="kw">round</span>(class<span class="op">$</span>brks, <span class="dt">digits=</span><span class="dv">1</span>)

<span class="co"># Plot the shape file and the selected variable</span>
<span class="kw">plot</span>(orotl.shp, <span class="dt">xlim=</span><span class="kw">c</span>(<span class="op">-</span><span class="fl">124.5</span>, <span class="op">-</span><span class="dv">115</span>), <span class="dt">ylim=</span><span class="kw">c</span>(<span class="dv">41</span>,<span class="dv">47</span>))
<span class="co"># add points</span>
<span class="kw">points</span>(longitude, latitude, <span class="dt">pch=</span><span class="dv">16</span>, <span class="dt">col=</span>colcode, <span class="dt">cex=</span><span class="dv">2</span>)
<span class="kw">points</span>(longitude, latitude, <span class="dt">cex=</span><span class="dv">2</span>)
<span class="co"># add legend</span>
<span class="kw">legend</span>(<span class="op">-</span><span class="dv">117</span>, <span class="dv">45</span>, <span class="dt">legend=</span><span class="kw">names</span>(<span class="kw">attr</span>(colcode, <span class="st">&quot;table&quot;</span>)),
   <span class="dt">fill=</span><span class="kw">attr</span>(colcode, <span class="st">&quot;palette&quot;</span>), <span class="dt">cex=</span><span class="fl">0.6</span>, <span class="dt">bty=</span><span class="st">&quot;n&quot;</span>)
<span class="kw">title</span>(plottitle)</code></pre></div>
<p>To plot maps of additional variables, only the second and third blocks of code will need to be executed again, after changing:</p>
<ol style="list-style-type: decimal">
<li>The title of the plot (<code>plottitle</code> – a text string in quotes)</li>
<li>the name of the variable to plot (<code>varname</code> – e.g. <code>&quot;tann&quot;</code> – note the quotes), and</li>
<li>the object to plot (<code>tann</code> in this example)</li>
</ol>
<p>It will be convenient to copy Blocks 2 and 3 into a script editor for editing. It will also be extremely useful to copy the maps to a Word document as they are created. Although we’ve looked at this data set before, it would be a good idea to look at the basic patterns again.</p>
<p><strong>3. An initial “null” or “naïve” model</strong></p>
<p>The simplest of models is one in which a single value, usually the mean, is used as the “fitted value” or prediction for each observation. This model can be thought of as a “naïve” model—the only thing the response variables “knows about” is its own mean value, and nothing about the influence of the eventual predictor variables. It might be the case that the potential predictor variables (elevation, location) have no influence on the response variable, and in such a case, the mean might be the best predictor of the values of the response variable, but a rather boring one from the perspective of explanation.</p>
<p>The null or naive model can be fit using the lm() function that is used to fit more elaborate models.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># a null model, mean as the prediction</span>
tann.lm0 &lt;-<span class="st"> </span><span class="kw">lm</span>(tann <span class="op">~</span><span class="st"> </span><span class="dv">1</span>)</code></pre></div>
<p>Note the “formula” in the function above; <code>tann ~ 1</code> means “predict <code>tann</code> as a function of a constant value” (namely the mean). The <code>lm()</code> function is silent, meaning it does not produce any output itself, but it can always be examined by typing the name of the object it produces, e.g., <code>tann.lm0</code>, or by applying the <code>summary()</code> or <code>attributes()</code> functions to that object</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># plot the regression line</span>
<span class="kw">plot</span>(tann <span class="op">~</span><span class="st"> </span>elevation)
<span class="kw">abline</span>(<span class="kw">abline</span>(<span class="kw">mean</span>(tann),<span class="dv">0</span>))</code></pre></div>
<p>Here the regression line is simply a horizontal line at the mean value of the response variable. Another way of looking at this is that the slope of the regression line is 0, and the intercept is equal to the mean of the dependent or response variable.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># examine the model object</span>
<span class="kw">summary</span>(tann.lm0)</code></pre></div>
<p>The <code>summary()</code> function here provides, in the case of this initial model, a somewhat overblown description of the mean and standard deviation of <code>tann</code>, which can be verified using the <code>mean()</code> and <code>sd()</code> functions.</p>
<p>The <code>plot()</code> function with a model object as an argument provides a sequence of four diagnostic plots. These include:</p>
<ul>
<li>residuals vs fit: there should be no discernable pattern on this plot.</li>
<li>normal QQ plot for the residuals: if the residuals are normally distributed, the points on this plot should plot along a straight line.</li>
<li>residuals vs. leverage plot: if the fit of the model is good, and there are no distinctive outliers, there should be no discernible pattern on this plot.</li>
<li>Cook’s distance: spikes on this plot indicate observations that have an unusually large influence on the regression analysis.</li>
</ul>
<p>Before plotting, use the <code>par()</code> function to set up a 2x2 arrangement of plots.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># standard regression diagnostics (4-up)</span>
oldpar &lt;-<span class="st"> </span><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">2</span>))
<span class="kw">plot</span>(tann.lm0, <span class="dt">which=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">4</span>))
<span class="kw">par</span>(oldpar)</code></pre></div>
<p>(Note that only three plots are produced here—the leverage plot is skipped for this model, because it doesn’t make any sense.))</p>
<p>The first use of the <code>par()</code> function sets up the RGraphics window to contain four plots on a single page, and <code>par(oldpar)</code> restores the original one-plot per page format. In the case of this “null” model, the normal QQ plot will provide information on the normality of the residuals, while the Cook’s distance plot indicates which observations have large influence on the mean.</p>
<p>The residuals (deviations from the mean) can be referenced as <code>tann.lm0$residuals</code>. Use the code in Part 2 above to map <code>tann.lm0$residuals</code>. The first three lines of Block 2 should read (note the quotes in the assignment for <code>varname</code> and their absence in the assignment for <code>plotvar</code>–the first is a text string, and the second is the name of an object).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">plottitle &lt;-<span class="st"> &quot;Residuals from tann.lm0 (C)&quot;</span>  
varname &lt;-<span class="st"> &quot;tann.lm0$residuals&quot;</span> 
plotvar &lt;-<span class="st"> </span>tann.lm0<span class="op">$</span>residuals</code></pre></div>
<blockquote>
<p>Q1: Compare the values and the patterns of the maps of <code>tann</code> and <code>tann.lm0$residuals</code>. How are they alike, and how are they different? (Hint: Be sure to create and examine the legends.)</p>
</blockquote>
<p><strong>4. Bivariate regression</strong></p>
<p>From previous analyses, it’s apparent that <code>tann</code> has a clear relationship with <code>elevation</code>, and so the successive regressions will begin using elevation as a predictor. Before fitting the regression model, explore the relationship between <code>tann and elevation</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># first regression model -- tann ~ elev</span>
tann.lm1 &lt;-<span class="st"> </span><span class="kw">lm</span>(tann <span class="op">~</span><span class="st"> </span>elevation)</code></pre></div>
<p>The <code>lm()</code> function fits linear (straight-line) relationships between the response variable (<code>tann</code>) and the predictor (<code>elevation</code>). Note the formula used here: <code>tann</code> varies as a function of <code>elevation</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># plot the regression line</span>
<span class="kw">plot</span>(tann <span class="op">~</span><span class="st"> </span>elevation)
<span class="kw">abline</span>(tann.lm1, <span class="dt">col=</span><span class="st">&quot;blue&quot;</span>)</code></pre></div>
<p>The <code>plot()</code> and <code>abline()</code> functions plot the data and draw regression line</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># examine the model object</span>
<span class="kw">summary</span>(tann.lm1)</code></pre></div>
<p>Note that the summary table now includes the regression coefficients and several goodness-of-fit statistics.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># standard regression diagnostics (4-up)</span>
oldpar &lt;-<span class="st"> </span><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">2</span>))
<span class="kw">plot</span>(tann.lm1, <span class="dt">which=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">4</span>,<span class="dv">5</span>))
<span class="kw">par</span>(oldpar)</code></pre></div>
<p>Replot the residual scatter plot (residuals vs. fitted values), adding a lowess curve to emphasize the pattern.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># another view of the residual scatter diagram</span>
<span class="kw">plot</span>(tann.lm1<span class="op">$</span>fitted.values, tann.lm1<span class="op">$</span>residuals)
<span class="kw">lines</span>(<span class="kw">lowess</span>(tann.lm1<span class="op">$</span>fitted.values, tann.lm1<span class="op">$</span>residuals, <span class="dt">f=</span><span class="fl">0.80</span>), <span class="dt">col=</span><span class="st">&quot;red&quot;</span>)</code></pre></div>
<blockquote>
<p>Q2: Examine the regression output in the console window. Is there a significant relationship between tann and elevation? What are the <em>F</em> statistic, its <em>p</em>-value, the Multiple R-Squared value, and the residual standard error? Are the intercept and slope significantly different from zero (and how do you know)?</p>
</blockquote>
<blockquote>
<p>Q3: Describe the patterns on the residuals vs. fit plot and normal QQ plot. Do these plots suggest that there is no information in the residuals, or is there some kind of pattern? Are there any unusually influential observations? Is this first analysis ok, or should we consider modifying it?</p>
</blockquote>
<p>(I’ll answer this one–there is a distinct arch-shaped pattern on the residuals vs fit plot, nicely summarized by the loess curve, and while the points are generally linear on the residual QQ plot, they begin to drift away from the 1:1 line for residual values greater than +1. The Crater Lake and Seneca values seem to have a large influence on the regression model. It looks like for this simple model, several of the underlying assumptions have been violated, and we should consider looking for a better model.)</p>
<p>Map the residual values from this simple linear regression model (<code>tann.lm1$residuals</code>), and compare their pattern with those of from the null model.</p>
<p><strong>5. Multiple regression</strong></p>
<p>One of the assumptions that underlies regression analysis is that we have fit the right model, and one way of expressing the other assumptions that describe the properties of the residuals is that the residuals should appear free of any pattern. This is clearly not the case for the simple model, and the reason should be apparent–the relationship between tann and elevation is not linear. There are two possible solutions. One would be to fit a non-linear model, for example a parabola or quadratic curve to the relationship, but there really isn’t a physical justification for why the temperature decrease with increasing elevation should be non-linear in that particular fashion. An alternative approach is to look for additional predictors variables that might be able to account for the pattern in the residuals, and include these in a “multiple regression model.”</p>
<p>An obvious set of additional predictor variables for this exercise is provided by latitude and longitude. (In practice, additional variables might not immediately come to mind.) Check to see whether any of the “information” (or pattern) in the residuals might be explained by latitude and longitude by constructing scatter plots with loess curves for the residuals:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># plot residuals vs. other predictors</span>
<span class="kw">plot</span>(tann.lm1<span class="op">$</span>residuals <span class="op">~</span><span class="st"> </span>longitude)
<span class="kw">lines</span>(<span class="kw">lowess</span>(tann.lm1<span class="op">$</span>residuals <span class="op">~</span><span class="st"> </span>longitude, <span class="dt">f=</span><span class="fl">0.80</span>), <span class="dt">col=</span><span class="st">&quot;red&quot;</span>)

<span class="kw">plot</span>(tann.lm1<span class="op">$</span>residuals <span class="op">~</span><span class="st"> </span>latitude)
<span class="kw">lines</span>(<span class="kw">lowess</span>(tann.lm1<span class="op">$</span>residuals <span class="op">~</span><span class="st"> </span>latitude, <span class="dt">f=</span><span class="fl">0.80</span>), <span class="dt">col=</span><span class="st">&quot;red&quot;</span>)</code></pre></div>
<blockquote>
<p>Q4: Describe the relationships between the residuals from the linear model and latitude and longitude. (Hint: It might be good to look at the maps of residuals too.)</p>
</blockquote>
<p>The relationships you should have seen in the above question are important enough that we should consider including longitude and latitude as predictors in the regression model. Here’s a multiple regression model that includes location:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># second regression -- tann ~ elevation + latitude + longitude</span>
tann.lm2 &lt;-<span class="st"> </span><span class="kw">lm</span>(tann <span class="op">~</span><span class="st"> </span>elevation <span class="op">+</span><span class="st"> </span>latitude <span class="op">+</span><span class="st"> </span>longitude)</code></pre></div>
<p>This code creates another model object <code>tann.lm2</code>, which contains the results of the multiple regression with <code>tann</code> as the response, and <code>elevation</code>, <code>latitude</code>, and <code>longitude</code> as predictors. Examine the diagnostic plots and maps of the residuals from <code>tann.lm2</code>. (Hint remember to change all instances of the model object and variable names in the blocks of code necessary to do this.)</p>
<blockquote>
<p>Q5: Look at the summary for this model. Describe how the <em>F</em>-statistic, its <em>p</em>-value, the <em>R<sup>2</sup>, and Residual Standard Error values have changed. Are all the predictors significant (Hint: examine their </em>t*-statistics.) Are any patterns in the residuals from this model less obvious than those from the previous model? Are they completely gone?</p>
</blockquote>
<p>Several other multiple regression models with elevation, latitude, and longitude as predictors, (each allowing for interactions among the predictors), in a sense create additional predictors (latitude x longitude, elevation x latitude), which in the case of spatial data as here, allow the predicted “surface” more flexibility. Here are two such interaction models:</p>
<p>tann.lm3 &lt;- lm(tann ~ elevation + latitude*longitude)</p>
<p>(allows for interactions between latitude and longitude, fitting a surface slightly more complex than a simple plane).</p>
<p>tann.lm4 &lt;- lm(tann ~ elevation<em>latitude</em>longitude)</p>
<p>(simultaneous interactions among all three predictors)</p>
<p>Because the exercise continues below, you might infer that fitting these more elaborate models doesn’t quite take care of the model deficiencies noted above.</p>
<p><strong>6. Nonparametric (Loess) regression</strong></p>
<p>It could be the case that the individual and joint relationships between <code>tann</code> and <code>elevation</code>, <code>latitude</code> and <code>longitude</code> in the previous multiple regressions aren’t quite perfectly represented by <em>linear</em> relationships. The loess fitting procedure can be generalized to more than one predictor variable, which allows the flexibility of the loess curve to be extended to the multiple regression context. In essence, the method produces a number of local regression analyses, allowing the form of the relationship to vary across the space defined by the predictor variables, which in this example, turns out to be geographical space.</p>
<p>Fit a “local” (loess) regression model to the <code>tann</code> data, using <code>elevation</code> as a predictor:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># loess -- simplest model</span>
tann.lo1 &lt;-<span class="st"> </span><span class="kw">loess</span>(tann <span class="op">~</span><span class="st"> </span>elevation, <span class="dt">span=</span><span class="fl">0.80</span>, <span class="dt">degree=</span><span class="dv">2</span>)

<span class="co"># examine the fit</span>
<span class="kw">summary</span>(tann.lo1)
<span class="kw">plot</span>(tann <span class="op">~</span><span class="st"> </span>elevation)
hat &lt;-<span class="st"> </span><span class="kw">predict</span>(tann.lo1)
<span class="kw">lines</span>(elevation[<span class="kw">order</span>(elevation)], hat[<span class="kw">order</span>(elevation)], <span class="dt">col=</span><span class="st">&quot;red&quot;</span>)
<span class="kw">cor</span>(tann, hat)<span class="op">^</span><span class="dv">2</span> </code></pre></div>
<p>The extraction of information from the model object (<code>tann.lo1</code>) is a little different when fitting a loess regression model than when fitting a linear model using the <code>lm()</code> function. Because loess regression is “nonparametric” there are no regression coefficients, and <em>F</em>- and <em>t</em>-statistics are not produced; however, the goodness-of-fit of the regression can still be determined using <em>R<sup>2</sum></em> and residual standard error values. For example, the <code>cor()</code> function can be used to get the correlation between the response variable and the fitted values. Squaring this value gives a statistic comparable with the <em>R<sup>2</sum></em> values from earlier regressions.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># residual scatter diagram</span>
<span class="kw">plot</span>(tann.lo1<span class="op">$</span>fitted, tann.lo1<span class="op">$</span>residuals)
<span class="kw">lines</span>(<span class="kw">lowess</span>(tann.lo1<span class="op">$</span>fitted, tann.lo1<span class="op">$</span>residuals, <span class="dt">f=</span><span class="fl">0.80</span>), <span class="dt">col=</span><span class="st">&quot;red&quot;</span>)

<span class="co"># normal probablility plot</span>
<span class="kw">qqnorm</span>(tann.lo1<span class="op">$</span>residuals)</code></pre></div>
<p>This block of code constructs the residual scatter diagram. Note that the fitted (predicted) values and the residuals are contained in the variables <code>tann.lo1$fitted</code>, and <code>tann.lo1$residuals</code>.</p>
<blockquote>
<p>Q6: Compare the results of this regression with the first linear regression (tann.lm1), in particular compare the goodness of fit, residual scatter diagram, and map patterns of residual. Does fitting a flexible or local curve improve the fit relative to fitting a straight line?</p>
</blockquote>
<p>Now fit an expanded model with elevation, latitude, and longitude as predictors (equivalent to <code>tann.lm2</code>):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># loess -- elevation, latitude, and longitude</span>
tann.lo2 &lt;-<span class="st"> </span><span class="kw">loess</span>(tann <span class="op">~</span><span class="st"> </span>elevation <span class="op">+</span><span class="st"> </span>latitude <span class="op">+</span><span class="st"> </span>longitude, <span class="dt">span=</span><span class="fl">0.80</span>, <span class="dt">degree=</span><span class="dv">2</span>)

<span class="co"># examine the fit</span>
<span class="kw">summary</span>(tann.lo2)
hat &lt;-<span class="st"> </span><span class="kw">predict</span>(tann.lo2)
<span class="kw">cor</span>(tann, hat)<span class="op">^</span><span class="dv">2</span>

<span class="co"># residual scatter diagram</span>
<span class="kw">plot</span>(tann.lo2<span class="op">$</span>fitted, tann.lo2<span class="op">$</span>residuals)
<span class="kw">lines</span>(<span class="kw">lowess</span>(tann.lo2<span class="op">$</span>fitted, tann.lo2<span class="op">$</span>residuals, <span class="dt">f=</span><span class="fl">0.80</span>), <span class="dt">col=</span><span class="st">&quot;red&quot;</span>)

<span class="co"># normal probablility plot</span>
<span class="kw">qqnorm</span>(tann.lo2<span class="op">$</span>residuals)</code></pre></div>
<blockquote>
<p>Q7: Does the loess regression fit the <code>tann</code> data better, worse, or about the same as the multiple regression? (Note: it might be easier to answer Q7 and Q8 simultaneously.) Examine the residual scatter diagrams and QQ Normal plots. Has there been any improvement (i.e. less pattern) in the residuals of the <code>tann.lo2</code> model relative to those from the other regressions?</p>
</blockquote>
<blockquote>
<p>Q8: Which of the various models seem to be the optimal one, and why do you think it is?</p>
</blockquote>
<p><strong>7. What to turn in</strong></p>
<p>Turn in answers to the above questions, and one or more of the plots you generated in section 2.</p>
<p>That’s all!</p>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
