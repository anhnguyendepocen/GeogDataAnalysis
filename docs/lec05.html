<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>Multivariate Plots</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; position: absolute; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine:empty
  { position: absolute; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; } /* Alert */
code span.an { color: #008000; } /* Annotation */
code span.at { } /* Attribute */
code span.bu { } /* BuiltIn */
code span.cf { color: #0000ff; } /* ControlFlow */
code span.ch { color: #008080; } /* Char */
code span.cn { } /* Constant */
code span.co { color: #008000; } /* Comment */
code span.cv { color: #008000; } /* CommentVar */
code span.do { color: #008000; } /* Documentation */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.im { } /* Import */
code span.in { color: #008000; } /* Information */
code span.kw { color: #0000ff; } /* Keyword */
code span.op { } /* Operator */
code span.ot { color: #ff4000; } /* Other */
code span.pp { color: #ff4000; } /* Preprocessor */
code span.sc { color: #008080; } /* SpecialChar */
code span.ss { color: #008080; } /* SpecialString */
code span.st { color: #008080; } /* String */
code span.va { } /* Variable */
code span.vs { color: #008080; } /* VerbatimString */
code span.wa { color: #008000; font-weight: bold; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' || rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="SI-md-08.css" type="text/css" />

</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<div class="container-fluid main-container">

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->





<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Geographic Data Analysis</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="overview.html">Overview</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Topics
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Lecture topics</li>
    <li>
      <a href="lec01.html">Introduction to the course</a>
    </li>
    <li>
      <a href="lec02.html">Univariate plots</a>
    </li>
    <li>
      <a href="lec03.html">Bivariate plots</a>
    </li>
    <li>
      <a href="lec04.html">Descriptive statistics</a>
    </li>
    <li>
      <a href="lec05.html">Multivariate plots</a>
    </li>
    <li>
      <a href="lec06.html">Maps in R</a>
    </li>
    <li>
      <a href="lec07.html">Geospatial analysis in R</a>
    </li>
    <li>
      <a href="lec08.html">Data wrangling and matrix algebra</a>
    </li>
    <li>
      <a href="lec09.html">Reference distributions</a>
    </li>
    <li>
      <a href="lec10.html">Statistical inference</a>
    </li>
    <li>
      <a href="lec11.html">Analysis of variance</a>
    </li>
    <li>
      <a href="lec12.html">Regression analysis</a>
    </li>
    <li>
      <a href="lec13.html">More regression analysis</a>
    </li>
    <li>
      <a href="lec14.html">Nonparametric regression</a>
    </li>
    <li>
      <a href="lec15.html">GLMs, GAMs, and CARTs</a>
    </li>
    <li>
      <a href="lec16.html">Principal components and factor analyses</a>
    </li>
    <li>
      <a href="lec17.html">MANOVA and discriminant analysis</a>
    </li>
    <li>
      <a href="lec18.html">Multivariate distances and cluster analysis</a>
    </li>
    <li>
      <a href="lec19.html">High-resolution and high-dimension data</a>
    </li>
    <li>
      <a href="lec20.html">Analysis and visualization of large raster data sets</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Exercises &amp; Exams
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Exercises</li>
    <li>
      <a href="ex01.html">Exercise 01 -- Getting R and RStudio</a>
    </li>
    <li>
      <a href="ex02.html">Exercise 02 -- Univariate plots</a>
    </li>
    <li>
      <a href="ex03.html">Exercise 03 -- Bivariate plots and descriptive statistics</a>
    </li>
    <li>
      <a href="ex04.html">Exercise 04 -- Multivariate plots</a>
    </li>
    <li>
      <a href="ex05.html">Exercise 05 -- Data wrangling and matrix algebra</a>
    </li>
    <li>
      <a href="ex06.html">Exercise 06 -- CI's, t-tests, ANOVA</a>
    </li>
    <li>
      <a href="ex07.html">Exercise 07 -- Regression analysis</a>
    </li>
    <li>
      <a href="ex08.html">Exercise 08 -- Multivariate analysis</a>
    </li>
    <li class="dropdown-header">Exams</li>
    <li>
      <a href="exam1.html">Exam 1</a>
    </li>
    <li>
      <a href="exam2.html">Exam 2</a>
    </li>
    <li class="dropdown-header">Other materials</li>
    <li>
      <a href="packages-and-data.html">Packages and Data</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Resources
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="readings.html">Readings</a>
    </li>
    <li>
      <a href="datasets.html">Datasets</a>
    </li>
    <li>
      <a href="oldpages.html">Old course web pages</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="about.html">About</a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Multivariate Plots</h1>

</div>

<div id="TOC">
<ul>
<li><a href="#enhanced-basic-plots"><span class="toc-section-number">1</span> Enhanced basic plots</a><ul>
<li><a href="#the-color-coded-scatter-plot-color-plot"><span class="toc-section-number">1.0.1</span> The color-coded scatter plot (color plot)</a></li>
<li><a href="#color-and-symbols"><span class="toc-section-number">1.1</span> Color and symbols</a></li>
<li><a href="#the-bubble-plot"><span class="toc-section-number">1.2</span> The bubble plot</a></li>
<li><a href="#d-point-cloud-plot"><span class="toc-section-number">1.3</span> 3-D point-cloud plot</a></li>
<li><a href="#d-scatter-plots-using-the-scatterplot3d-package"><span class="toc-section-number">1.4</span> 3-D Scatter plots (using the <code>scatterplot3d</code> package)</a></li>
</ul></li>
<li><a href="#opengl-surface-and-point-plots"><span class="toc-section-number">2</span> OpenGL surface and point plots</a><ul>
<li><a href="#coplots-conditioning-scatter-plots"><span class="toc-section-number">2.1</span> Coplots (conditioning scatter plots)</a></li>
<li><a href="#coplot-conditioning-by-one-continuous-numeric-variable"><span class="toc-section-number">2.2</span> Coplot, conditioning by one continuous numeric variable</a></li>
</ul></li>
<li><a href="#more-lattice-plots"><span class="toc-section-number">3</span> More Lattice Plots</a><ul>
<li><a href="#multipanel-plots"><span class="toc-section-number">3.1</span> Multipanel plots</a></li>
</ul></li>
</ul>
</div>

<p>#Introduction#</p>
<p>Multivariate descriptive displays or plots are designed to reveal the relationship among several variables simulataneously.. As was the case when examining relationships among pairs of variables, there are several basic characteristics of the relationship among sets of variables that are of interest. These include:</p>
<ul>
<li>the <em>forms</em> of the relationships</li>
<li>the <em>strength</em> of the relationships, and</li>
<li>the <em>dependence</em> of the relationships on external (usually to the pairs of variables being examined) circumstances.</li>
</ul>
<p>The easiest way to get the data for the multivariate plotting examples is to download a copy of the workspace <code>geog495.RData</code> and “load” it, or read it in. Otherwise, all of the individual data sets are available to download from the GeogR data page.</p>
<p>To get the workspace, right-click on this link <a href="https://pjbartlein.github.io/GeogDataAnalysis/data/Rdata/geog495.RData">[geog495.RData]</a> and save it to your working folder. (If you’ve forgotten where that is, type <code>getwd()</code> on the command line). Then read it in to R:</p>
<div id="enhanced-basic-plots" class="section level1">
<h1><span class="header-section-number">1</span> Enhanced basic plots</h1>
<p>##Enhanced 2-D Scatter plots ##</p>
<p>The scatter diagram or scatter plot is the workhorse bivariate plot, and can be enhanced to illustrate relationships among three (or four) variables.</p>
<div id="the-color-coded-scatter-plot-color-plot" class="section level3">
<h3><span class="header-section-number">1.0.1</span> The color-coded scatter plot (color plot)</h3>
<p>A basic “color plot”&quot; displays the values of three variables at a time using colored symbols, where the value of one variable determines the relative position of the symbol along the X-axis and the value of a second variable determines the relative position of the symbol along the Y-axis, and the value of the third variable is used to determine the color of the symbol.</p>
<p>The Specmap data set illustrated the variations over time of oxygen-isotope data (that records global ice volume, negative values mean little ice or globally warm conditions, positive values, large ice sheets, and globally cold conditions) which should theoretically depend on insolation (incoming solar radiation) at 65 N, which has been called the “pacemaker of the ice ages”. However, a simple plot of Insolation and O18 (and correlation) suggests otherwise:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw">attach</span>(specmap)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw">plot</span>(O18 <span class="op">~</span><span class="st"> </span>Insol, <span class="dt">pch=</span><span class="dv">16</span>, <span class="dt">cex=</span><span class="fl">0.6</span>)</a></code></pre></div>
<p><img src="lec05_files/figure-html/plot1-1.png" width="1200" /></p>
<p>The cloud of points (at first glace) is quite amorphous, and the correlation coefficient is also quite low:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="kw">cor</span>(O18, Insol)</a></code></pre></div>
<pre><code>## [1] -0.2415094</code></pre>
<p>Plotting <code>O18</code> as a function of <code>Age</code>, and color coding the symbols by <code>Insol</code> levels, reveals the nature of the control of ice volume by insolation:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="kw">library</span>(RColorBrewer)</a>
<a class="sourceLine" id="cb4-2" data-line-number="2"><span class="kw">library</span>(classInt) <span class="co"># class-interval recoding library</span></a>
<a class="sourceLine" id="cb4-3" data-line-number="3">plotvar &lt;-<span class="st"> </span>Insol</a>
<a class="sourceLine" id="cb4-4" data-line-number="4">nclr &lt;-<span class="st"> </span><span class="dv">8</span></a>
<a class="sourceLine" id="cb4-5" data-line-number="5">plotclr &lt;-<span class="st"> </span><span class="kw">brewer.pal</span>(nclr,<span class="st">&quot;PuOr&quot;</span>)</a>
<a class="sourceLine" id="cb4-6" data-line-number="6">plotclr &lt;-<span class="st"> </span>plotclr[nclr<span class="op">:</span><span class="dv">1</span>] <span class="co"># reorder colors</span></a>
<a class="sourceLine" id="cb4-7" data-line-number="7">class &lt;-<span class="st"> </span><span class="kw">classIntervals</span>(plotvar, nclr, <span class="dt">style=</span><span class="st">&quot;quantile&quot;</span>)</a>
<a class="sourceLine" id="cb4-8" data-line-number="8">colcode &lt;-<span class="st"> </span><span class="kw">findColours</span>(class, plotclr)</a>
<a class="sourceLine" id="cb4-9" data-line-number="9"></a>
<a class="sourceLine" id="cb4-10" data-line-number="10"><span class="kw">plot</span>(O18 <span class="op">~</span><span class="st"> </span>Age, <span class="dt">ylim=</span><span class="kw">c</span>(<span class="fl">2.5</span>,<span class="op">-</span><span class="fl">2.5</span>), <span class="dt">type=</span><span class="st">&quot;l&quot;</span>)</a>
<a class="sourceLine" id="cb4-11" data-line-number="11"><span class="kw">points</span>(O18 <span class="op">~</span><span class="st"> </span>Age, <span class="dt">pch=</span><span class="dv">16</span>, <span class="dt">col=</span>colcode, <span class="dt">cex=</span><span class="fl">1.5</span>)</a></code></pre></div>
<p><img src="lec05_files/figure-html/plot2-1.png" width="2100" /></p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="kw">detach</span>(specmap)</a></code></pre></div>
<p>Now it’s possible to see that warm (and warming) intervals (points near the top of the plot) tend to have high (orange) solar radiation values, while cooling and cold intervals follow periods of declining solar radiation (blue).</p>
</div>
<div id="color-and-symbols" class="section level2">
<h2><span class="header-section-number">1.1</span> Color and symbols</h2>
<p>Information from four variables at a time can also be displayed. In this example for the Summit Cr. data (a scatter plot of <code>WidthWS</code> as a function of <code>CumLen</code>), the plotting character is determined by Reach and its color by HU. Although these are factors, numerical variables could also be plotted.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="kw">attach</span>(sumcr)</a>
<a class="sourceLine" id="cb6-2" data-line-number="2"><span class="kw">plot</span>(WidthWS <span class="op">~</span><span class="st"> </span>CumLen, <span class="dt">pch=</span><span class="kw">as.integer</span>(Reach), <span class="dt">col=</span><span class="kw">as.integer</span>(HU))</a>
<a class="sourceLine" id="cb6-3" data-line-number="3"><span class="kw">legend</span>(<span class="dv">25</span>, <span class="dv">2</span>, <span class="kw">c</span>(<span class="st">&quot;Reach A&quot;</span>, <span class="st">&quot;Reach B&quot;</span>, <span class="st">&quot;Reach C&quot;</span>), <span class="dt">pch=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>), <span class="dt">col=</span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb6-4" data-line-number="4"><span class="kw">legend</span>(<span class="dv">650</span>, <span class="dv">2</span>, <span class="kw">c</span>(<span class="st">&quot;Glide&quot;</span>, <span class="st">&quot;Pool&quot;</span>, <span class="st">&quot;Riffle&quot;</span>), <span class="dt">pch=</span><span class="dv">1</span>, <span class="dt">col=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>))</a></code></pre></div>
<p><img src="lec05_files/figure-html/plot3-1.png" width="2100" /></p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="kw">detach</span>(sumcr)</a></code></pre></div>
<p>Note the use of two applications of the <code>legend()</code> function: the circles indicate the upstream grazed reach (reach A), the triangles indicate the cattle-exclosure reach (B), and the pluses indicate the downstream grazed reach (C), while black indicates glides, red indicates pools, and green indicates riffles.</p>
</div>
<div id="the-bubble-plot" class="section level2">
<h2><span class="header-section-number">1.2</span> The bubble plot</h2>
<p>The bubble plot displays the values of three variables at a time using graduated symbols (usually circles), where the value of one variable determines the relative position of the symbol along the X-axis and the value of a second variable determines the relative position of the symbol along the Y-axis, and the value of the third variable is used to determine the size of the symbol. Here’s a crude map of the elevations of the Oregon climate stations, which reflects the overall topography of the state.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="kw">attach</span>(orstationc)</a>
<a class="sourceLine" id="cb8-2" data-line-number="2"><span class="kw">plot</span>(lon, lat, <span class="dt">type=</span><span class="st">&quot;n&quot;</span>)</a>
<a class="sourceLine" id="cb8-3" data-line-number="3"><span class="kw">symbols</span>(lon, lat, <span class="dt">circles=</span>elev, <span class="dt">inches=</span><span class="fl">0.1</span>, <span class="dt">add=</span>T)</a></code></pre></div>
<p><img src="lec05_files/figure-html/plot4-1.png" width="2100" /> <a href="lec05.html">[Back to top]</a></p>
<p>#3-D Scatter plots #</p>
<p>3-D scatter plots (as distinct from scatter plot matrices involving three variables), illustrate the relationship among three variables by plotting them in a three-dimensional “workbox”. There are a number of basic enhancements of the basic 3-D scatter plot, such as the addition of drop lines, lines connecting points, symbol modification and so on.</p>
</div>
<div id="d-point-cloud-plot" class="section level2">
<h2><span class="header-section-number">1.3</span> 3-D point-cloud plot</h2>
<p>This plot displays the values of three variables at a time by plotting them in a 3-D “workbox” where the value of one variable determines the relative position of the symbol along the X-axis and the value of a second variable determines the relative position of the symbol along the Y-axis, and the value of the third variable is used to determine the relative position along the Z-axis. This plot makes use of the <code>lattice</code> package.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="kw">library</span>(lattice)</a>
<a class="sourceLine" id="cb9-2" data-line-number="2"><span class="kw">cloud</span>(elev <span class="op">~</span><span class="st"> </span>lon<span class="op">*</span>lat)</a></code></pre></div>
<p><img src="lec05_files/figure-html/plot5-1.png" width="2100" /></p>
<p>Notice that you can still see the outline of the state, because elevation is a fairly well behaved variable.</p>
</div>
<div id="d-scatter-plots-using-the-scatterplot3d-package" class="section level2">
<h2><span class="header-section-number">1.4</span> 3-D Scatter plots (using the <code>scatterplot3d</code> package)</h2>
<p>The <code>scatterplot3d</code> package (by Ligges and Mächler) provides a way of constructing a 3-point cloud display with some nice embellishments. The first part of the code, like in making maps, does some setup like determining the number of colors to plot and getting their definitions. The second block produces the plot.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="kw">library</span>(scatterplot3d)</a>
<a class="sourceLine" id="cb10-2" data-line-number="2"><span class="kw">library</span>(RColorBrewer)</a>
<a class="sourceLine" id="cb10-3" data-line-number="3"></a>
<a class="sourceLine" id="cb10-4" data-line-number="4"><span class="co"># get colors for labeling the points</span></a>
<a class="sourceLine" id="cb10-5" data-line-number="5">plotvar &lt;-<span class="st"> </span>pann <span class="co"># pick a variable to plot</span></a>
<a class="sourceLine" id="cb10-6" data-line-number="6">nclr &lt;-<span class="st"> </span><span class="dv">8</span> <span class="co"># number of colors</span></a>
<a class="sourceLine" id="cb10-7" data-line-number="7">plotclr &lt;-<span class="st"> </span><span class="kw">brewer.pal</span>(nclr,<span class="st">&quot;PuBu&quot;</span>) <span class="co"># get the colors</span></a>
<a class="sourceLine" id="cb10-8" data-line-number="8">colornum &lt;-<span class="st"> </span><span class="kw">cut</span>(<span class="kw">rank</span>(plotvar), nclr, <span class="dt">labels=</span><span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb10-9" data-line-number="9">colcode &lt;-<span class="st"> </span>plotclr[colornum] <span class="co"># assign color</span></a>
<a class="sourceLine" id="cb10-10" data-line-number="10"></a>
<a class="sourceLine" id="cb10-11" data-line-number="11"><span class="co"># scatter plot</span></a>
<a class="sourceLine" id="cb10-12" data-line-number="12">plot.angle &lt;-<span class="st"> </span><span class="dv">45</span></a>
<a class="sourceLine" id="cb10-13" data-line-number="13"><span class="kw">scatterplot3d</span>(lon, lat, plotvar, <span class="dt">type=</span><span class="st">&quot;h&quot;</span>, <span class="dt">angle=</span>plot.angle, <span class="dt">color=</span>colcode, <span class="dt">pch=</span><span class="dv">20</span>, <span class="dt">cex.symbols=</span><span class="dv">2</span>, </a>
<a class="sourceLine" id="cb10-14" data-line-number="14">  <span class="dt">col.axis=</span><span class="st">&quot;gray&quot;</span>, <span class="dt">col.grid=</span><span class="st">&quot;gray&quot;</span>)</a></code></pre></div>
<p><img src="lec05_files/figure-html/plot6-1.png" width="2100" /></p>
<p>The z-variable, in this case, annual precipitation, is plotted as a dot, and for interpretability a drop line is plotted below the dot. This simple addition facilitates finding the location of each point (where it hits the x-y, or latitude-longitude plane), as well as the value of annual precipitation.</p>
<p>Maps can be added to the 3-D scatter plot to improve interpretability:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="kw">library</span>(maps)</a>
<a class="sourceLine" id="cb11-2" data-line-number="2"></a>
<a class="sourceLine" id="cb11-3" data-line-number="3"><span class="co"># get points that define Oregon county outlines</span></a>
<a class="sourceLine" id="cb11-4" data-line-number="4">or.map &lt;-<span class="st"> </span><span class="kw">map</span>(<span class="st">&quot;county&quot;</span>, <span class="st">&quot;oregon&quot;</span>, <span class="dt">xlim=</span><span class="kw">c</span>(<span class="op">-</span><span class="dv">125</span>,<span class="op">-</span><span class="dv">114</span>), <span class="dt">ylim=</span><span class="kw">c</span>(<span class="dv">42</span>,<span class="dv">47</span>), <span class="dt">plot=</span><span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb11-5" data-line-number="5"></a>
<a class="sourceLine" id="cb11-6" data-line-number="6"><span class="co"># get colors for labeling the points</span></a>
<a class="sourceLine" id="cb11-7" data-line-number="7">plotvar &lt;-<span class="st"> </span>pann <span class="co"># pick a variable to plot</span></a>
<a class="sourceLine" id="cb11-8" data-line-number="8">nclr &lt;-<span class="st"> </span><span class="dv">8</span> <span class="co"># number of colors</span></a>
<a class="sourceLine" id="cb11-9" data-line-number="9">plotclr &lt;-<span class="st"> </span><span class="kw">brewer.pal</span>(nclr,<span class="st">&quot;PuBu&quot;</span>) <span class="co"># get the colors</span></a>
<a class="sourceLine" id="cb11-10" data-line-number="10">colornum &lt;-<span class="st"> </span><span class="kw">cut</span>(<span class="kw">rank</span>(plotvar), nclr, <span class="dt">labels=</span><span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb11-11" data-line-number="11">colcode &lt;-<span class="st"> </span>plotclr[colornum] <span class="co"># assign color</span></a>
<a class="sourceLine" id="cb11-12" data-line-number="12"></a>
<a class="sourceLine" id="cb11-13" data-line-number="13"><span class="co"># scatterplot and map</span></a>
<a class="sourceLine" id="cb11-14" data-line-number="14">plot.angle &lt;-<span class="st"> </span><span class="dv">135</span></a>
<a class="sourceLine" id="cb11-15" data-line-number="15">s3d &lt;-<span class="st"> </span><span class="kw">scatterplot3d</span>(lon, lat, plotvar, <span class="dt">type=</span><span class="st">&quot;h&quot;</span>, <span class="dt">angle=</span>plot.angle, <span class="dt">color=</span>colcode, <span class="dt">pch=</span><span class="dv">20</span>, <span class="dt">cex.symbols=</span><span class="dv">2</span>, <span class="dt">col.axis=</span><span class="st">&quot;gray&quot;</span>, <span class="dt">col.grid=</span><span class="st">&quot;gray&quot;</span>)</a>
<a class="sourceLine" id="cb11-16" data-line-number="16">s3d<span class="op">$</span><span class="kw">points3d</span>(or.map<span class="op">$</span>x,or.map<span class="op">$</span>y,<span class="kw">rep</span>(<span class="dv">0</span>,<span class="kw">length</span>(or.map<span class="op">$</span>x)), <span class="dt">type=</span><span class="st">&quot;l&quot;</span>)</a></code></pre></div>
<p><img src="lec05_files/figure-html/plot7-1.png" width="2100" /></p>
<p>The <code>map()</code> function generates the outlines of a map of Oregon counties, and stores them in <code>or.map</code>, then the colors are figured out, and finally a 3-D scatter plot is made (using the <code>scatterplot3d()</code> function, and finally a 3-D scatter plot is made (using the scatterplot3d() function, and the points and droplines are added.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1"><span class="kw">detach</span>(orstationc)</a></code></pre></div>
<p><a href="lec05.html">[Back to top]</a></p>
</div>
</div>
<div id="opengl-surface-and-point-plots" class="section level1">
<h1><span class="header-section-number">2</span> OpenGL surface and point plots</h1>
<p>The <code>rgl</code> package (by D. Alder) can be used to plot points (and surfaces and lines) in a 3-D space. The main feature that distinguishes this approach is the ability to rotate the cloud of points “on the fly.” Here’s what the code looks like, and when the image appears, it can be rotated and spun by dragging the mouse within the window. Holding down the left button while dragging rotates the balls, while holding down the right changes the perspective.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1"><span class="kw">library</span>(rgl)</a>
<a class="sourceLine" id="cb13-2" data-line-number="2"><span class="kw">example</span>(rgl.surface)</a>
<a class="sourceLine" id="cb13-3" data-line-number="3"></a>
<a class="sourceLine" id="cb13-4" data-line-number="4"><span class="kw">rgl.clear</span>()</a>
<a class="sourceLine" id="cb13-5" data-line-number="5"><span class="kw">example</span>(rgl.spheres)</a></code></pre></div>
<p><img src="https://pjbartlein.github.io/GeogDataAnalysis/figures/rgl01.jpg" alt="rgl01" /> <a href="lec05.html">[Back to top]</a></p>
<p>#Trellis/Lattice graphics#</p>
<p>Many data sets include a mixture of both “continuous” (ordinal-, interval- or ratio-scale variables) and “discrete” (nominal-scale variables). Often, the issue might arise of how a particular relationship between variables might differ among groups. Information of that nature can be gained using conditioning plots (or coplots). Such plots are part of a general scheme of visual data analysis, known as Trellis Graphics that has been created by the developers of the S language. Trellis Graphics are implemented in R using the package Lattice.</p>
<div id="coplots-conditioning-scatter-plots" class="section level2">
<h2><span class="header-section-number">2.1</span> Coplots (conditioning scatter plots)</h2>
<p>Conditioning scatter plots involves creating a multipanel display, where each panel contains a subset of the data. This subset can be either a) those observations that fall in a particular group, or b) they may represent a the values that fall within a particular range of the values of a variable. The idea is that the individual panels should illustrate the relationship between a pair of variables, over part of the range of the two marginal “conditioning” variables (i.e. the relationship “conditional on one marginal variable lying in one particular interval, and the other lying in a different interval.”)</p>
<p>This coplot contains scatter diagrams for Yes as a function of the log(10) of Population, conditioned by country (i.e. one “response” variable and one “conditioning” variable.)</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1"><span class="kw">library</span>(lattice)</a>
<a class="sourceLine" id="cb14-2" data-line-number="2"><span class="kw">attach</span>(scanvote)</a>
<a class="sourceLine" id="cb14-3" data-line-number="3"><span class="kw">coplot</span>(Yes <span class="op">~</span><span class="st"> </span><span class="kw">log10</span>(Pop) <span class="op">|</span><span class="st"> </span>Country, <span class="dt">columns=</span><span class="dv">3</span>,</a>
<a class="sourceLine" id="cb14-4" data-line-number="4">     <span class="dt">panel=</span><span class="cf">function</span>(x,y,...) {</a>
<a class="sourceLine" id="cb14-5" data-line-number="5">          <span class="kw">panel.smooth</span>(x,y,<span class="dt">span=</span>.<span class="dv">8</span>,<span class="dt">iter=</span><span class="dv">5</span>,...)</a>
<a class="sourceLine" id="cb14-6" data-line-number="6">          <span class="kw">abline</span>(<span class="kw">lm</span>(y <span class="op">~</span><span class="st"> </span>x), <span class="dt">col=</span><span class="st">&quot;blue&quot;</span>) } </a>
<a class="sourceLine" id="cb14-7" data-line-number="7">)</a></code></pre></div>
<p><img src="lec05_files/figure-html/plot16-1.png" width="2100" /></p>
<p>Note the use of the “panel” function here. Basically, what’s going on is that the <code>coplot()</code> function is determining which subset of observations should appear in each panel, while the two function calls within the <code>panel()</code> function (<code>panel.smooth()</code> and <code>abline()</code>) perform their tasks on that subset of observations. In other words, <code>coplot()</code> selects the observations of <code>Yes</code> and <code>log(Pop)</code> for a particular panel (i.e. <code>Country</code>), sends these to the panel function, which passes them on (relabeled as x and y), and plots the points, and then <code>panel.smooth()</code> and <code>albline()</code> draw a lowess curve and least-squares line for those observations on each panel (more about those later). The general idea is to compare the panels (countries) seeing where in the panel the points lie and what the relationship looks like. The general relationship between population and percent of <code>Yes</code> votes is apparent, as well as country-to-country differences, like the generally greater proportion of <code>Yes</code> votes in Finland.</p>
</div>
<div id="coplot-conditioning-by-one-continuous-numeric-variable" class="section level2">
<h2><span class="header-section-number">2.2</span> Coplot, conditioning by one continuous numeric variable</h2>
<p>Most of the time, the conditioning variables are continuous numeric variables. Here’s a coplot for <code>WidthWS</code> as a function of <code>DepthWS</code> in the Summit Cr. data set, conditioned by <code>CumLen</code> (or distance downsteam):</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1"><span class="kw">attach</span>(sumcr)</a>
<a class="sourceLine" id="cb15-2" data-line-number="2"><span class="kw">coplot</span>(WidthWS <span class="op">~</span><span class="st"> </span>DepthWS <span class="op">|</span><span class="st"> </span>CumLen, <span class="dt">pch=</span><span class="dv">14</span><span class="op">+</span><span class="kw">as.integer</span>(Reach), <span class="dt">cex=</span><span class="fl">1.5</span>,</a>
<a class="sourceLine" id="cb15-3" data-line-number="3">     <span class="dt">number=</span><span class="dv">3</span>, <span class="dt">columns=</span><span class="dv">3</span>,</a>
<a class="sourceLine" id="cb15-4" data-line-number="4">     <span class="dt">panel=</span><span class="cf">function</span>(x,y,...) {</a>
<a class="sourceLine" id="cb15-5" data-line-number="5">          <span class="kw">panel.smooth</span>(x,y,<span class="dt">span=</span>.<span class="dv">8</span>,<span class="dt">iter=</span><span class="dv">5</span>,...)</a>
<a class="sourceLine" id="cb15-6" data-line-number="6">          <span class="kw">abline</span>(<span class="kw">lm</span>(y <span class="op">~</span><span class="st"> </span>x), <span class="dt">col=</span><span class="st">&quot;blue&quot;</span>)</a>
<a class="sourceLine" id="cb15-7" data-line-number="7">     }</a>
<a class="sourceLine" id="cb15-8" data-line-number="8">)</a></code></pre></div>
<p><img src="lec05_files/figure-html/plot17-1.png" width="2100" /></p>
<p>We know the arrangement of the reaches, and so the resulting plot should be no surprise. The plotting characters are determined by Reach, to reveal the extent of overlap in the conditioning “shingles.” The plot could be regenerated using Reach as the conditioning variable, which would result in no overlap between the individual panels.</p>
<p>It’s easy to see that the two grazed reaches (A upstream and C downstream) have generally wider channels, which would be expected. Something that is not apparent in ordinary plots of the data is that the “normal” or expected inverse relationship between width and depth (as one gets bigger the other gets smaller) does not apply in the middle (exclosure) reach.</p>
<p><a href="lec05.html">[Back to top]</a></p>
</div>
</div>
<div id="more-lattice-plots" class="section level1">
<h1><span class="header-section-number">3</span> More Lattice Plots</h1>
<p>“Trellis” plots are the R version of Lattice plots that were originally implemented in the S language at Bell Labs. The aim of these plots is to extend the usual kind of univariate and bivariate plots, like histograms or scatter plots, to situations where some external variables, possibly categorical or “factor” variables, may influence the distribution of the data or form of a relationship. They do this by generating a trellis or lattice of plots that consist of an array of simple plots, arranged according to the values of some “conditioning” variables.</p>
<div id="multipanel-plots" class="section level2">
<h2><span class="header-section-number">3.1</span> Multipanel plots</h2>
<p>A multipanel plot, in which the individual panels are “conditioned” by the value of a third variable, here longitude, can be illustrated for the Oregon climate station data using the following script:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1"><span class="kw">library</span>(lattice)</a>
<a class="sourceLine" id="cb16-2" data-line-number="2"></a>
<a class="sourceLine" id="cb16-3" data-line-number="3"><span class="kw">attach</span>(orstationc)</a></code></pre></div>
<pre><code>## The following objects are masked _by_ .GlobalEnv:
## 
##     x, y</code></pre>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1"><span class="co"># make a factor variable indicating which longitude band a station falls in</span></a>
<a class="sourceLine" id="cb18-2" data-line-number="2">Lon2 &lt;-<span class="st"> </span><span class="kw">equal.count</span>(lon,<span class="dv">8</span>,.<span class="dv">5</span>)</a>
<a class="sourceLine" id="cb18-3" data-line-number="3"><span class="co"># plot the lattice plot</span></a>
<a class="sourceLine" id="cb18-4" data-line-number="4">plot1 &lt;-<span class="st"> </span><span class="kw">xyplot</span>(pann <span class="op">~</span><span class="st"> </span>elev <span class="op">|</span><span class="st"> </span>Lon2,</a>
<a class="sourceLine" id="cb18-5" data-line-number="5">    <span class="dt">layout =</span> <span class="kw">c</span>(<span class="dv">4</span>, <span class="dv">2</span>),</a>
<a class="sourceLine" id="cb18-6" data-line-number="6">    <span class="dt">panel =</span> <span class="cf">function</span>(x, y) {</a>
<a class="sourceLine" id="cb18-7" data-line-number="7">        <span class="kw">panel.grid</span>(<span class="dt">v=</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb18-8" data-line-number="8">        <span class="kw">panel.xyplot</span>(x, y)</a>
<a class="sourceLine" id="cb18-9" data-line-number="9">        <span class="kw">panel.loess</span>(x, y, <span class="dt">span =</span> <span class="fl">1.0</span>, <span class="dt">degree =</span> <span class="dv">1</span>, <span class="dt">family=</span><span class="st">&quot;symmetric&quot;</span>)</a>
<a class="sourceLine" id="cb18-10" data-line-number="10">        <span class="kw">panel.abline</span>(<span class="kw">lm</span>(y<span class="op">~</span>x))</a>
<a class="sourceLine" id="cb18-11" data-line-number="11">    },</a>
<a class="sourceLine" id="cb18-12" data-line-number="12">    <span class="dt">xlab =</span> <span class="st">&quot;Elevation (m)&quot;</span>,</a>
<a class="sourceLine" id="cb18-13" data-line-number="13">    <span class="dt">ylab =</span> <span class="st">&quot;Annual Precipitation (mm)&quot;</span></a>
<a class="sourceLine" id="cb18-14" data-line-number="14">)</a>
<a class="sourceLine" id="cb18-15" data-line-number="15"><span class="kw">print</span>(plot1, <span class="dt">position=</span><span class="kw">c</span>(<span class="dv">0</span>,.<span class="dv">375</span>,<span class="dv">1</span>,<span class="dv">1</span>), <span class="dt">more=</span>T)</a>
<a class="sourceLine" id="cb18-16" data-line-number="16"></a>
<a class="sourceLine" id="cb18-17" data-line-number="17"><span class="co"># add the shingles</span></a>
<a class="sourceLine" id="cb18-18" data-line-number="18"><span class="kw">print</span>(<span class="kw">plot</span>(Lon2), <span class="dt">position=</span><span class="kw">c</span>(.<span class="dv">1</span>,<span class="fl">0.0</span>,.<span class="dv">9</span>,.<span class="dv">4</span>))</a></code></pre></div>
<p><img src="lec05_files/figure-html/plot18-1.png" width="2100" /></p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1"><span class="kw">detach</span>(orstationc)</a></code></pre></div>
<p>The idea here is to chop longitude into eight bands from west to east using the equal.count() function. (The third argument here, 0.5, indicates that the bands should overlap by 50 percent.) Then the lattice plot is made using the xyplot() function, which makes a separate scatter plot for each longitude band, showing the relationship between annual precipitation and elevation. A “shingles” plot is added at the bottom to indicate the range of longitudes that go into each plot.</p>
<p>Notice that in each panel, a straight regression line (more about regression later) and a smooth lowess curve have been added to help summarize the relationships. The panels are arranged in longitudinal order from low (west) to high (east, remember that in the western hemisphere, longitudes are negative). The plots are certainly interesting. The general idea is that precipitation should increase with increasing elevation, but at least for the western part of the state the reverse seems to be true! What is going on here is that proximity to the Pacific is a much more important control than elevation, and low elevation coastal and inland stations are quite wet. In the eastern part of the state (top row of panels), the expected relationship holds, but it’s kind of hard to see because the wet western part of the state stretches out the scale.,</p>
<p>The following plots explore the seasonality of precipitation in the Yellowstone region. This first plot uses glyphs to show the values of twelve monthly precipitation variables as “spokes” of a wheel, where each variable is plotted relative to its overall range. The first block of code below sets things up, and the <code>stars()</code> function does the plotting.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" data-line-number="1"><span class="kw">library</span>(sp)</a>
<a class="sourceLine" id="cb20-2" data-line-number="2"><span class="kw">attach</span>(yellpratio)</a>
<a class="sourceLine" id="cb20-3" data-line-number="3"></a>
<a class="sourceLine" id="cb20-4" data-line-number="4"><span class="co"># simple map</span></a>
<a class="sourceLine" id="cb20-5" data-line-number="5"><span class="co"># plot Yellowstone shape files</span></a>
<a class="sourceLine" id="cb20-6" data-line-number="6"><span class="kw">plot</span>(ynpstate.shp)</a>
<a class="sourceLine" id="cb20-7" data-line-number="7"><span class="kw">plot</span>(ynplk.shp, <span class="dt">add=</span>T)</a>
<a class="sourceLine" id="cb20-8" data-line-number="8"><span class="kw">plot</span>(ynprivers.shp, <span class="dt">add=</span>T)</a>
<a class="sourceLine" id="cb20-9" data-line-number="9"><span class="kw">points</span>(Lon, Lat)</a>
<a class="sourceLine" id="cb20-10" data-line-number="10"></a>
<a class="sourceLine" id="cb20-11" data-line-number="11"><span class="co"># stars plot for precipitation ratios</span></a>
<a class="sourceLine" id="cb20-12" data-line-number="12">col.red &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="st">&quot;red&quot;</span>,<span class="kw">length</span>(orstationc[,<span class="dv">1</span>]))</a>
<a class="sourceLine" id="cb20-13" data-line-number="13"><span class="kw">stars</span>(yellpratio[,<span class="dv">4</span><span class="op">:</span><span class="dv">15</span>], <span class="dt">locations=</span><span class="kw">as.matrix</span>(<span class="kw">cbind</span>(Lon, Lat)),</a>
<a class="sourceLine" id="cb20-14" data-line-number="14"><span class="dt">col.stars=</span>col.red, <span class="dt">len=</span><span class="fl">0.2</span>, <span class="dt">key.loc=</span><span class="kw">c</span>(<span class="op">-</span><span class="fl">111.5</span>,<span class="fl">42.5</span>), <span class="dt">labels=</span><span class="ot">NULL</span>, <span class="dt">add=</span>T)</a></code></pre></div>
<p><img src="lec05_files/figure-html/plot19-1.png" width="2100" /></p>
<p>Here the stars wind up looking more like fans. The legend indicates that stations with fans that open out to the right are stations with winter precipitation maxima (like in the southwestern portion of the region) while those that open toward the left have summer precipitation maxima (like in the southeastern portion of the region).</p>
<p>The next examples show a couple of conditioning plots (coplots), that illustrate the relationship between January and July precipitation, as varies (is conditioned on) with elevation. The first block of code does some set up.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" data-line-number="1"><span class="co"># create some conditioning variables</span></a>
<a class="sourceLine" id="cb21-2" data-line-number="2">Elevation &lt;-<span class="st"> </span><span class="kw">equal.count</span>(Elev,<span class="dv">4</span>,.<span class="dv">25</span>)</a>
<a class="sourceLine" id="cb21-3" data-line-number="3">Latitude &lt;-<span class="st"> </span><span class="kw">equal.count</span>(Lat,<span class="dv">2</span>,.<span class="dv">25</span>)</a>
<a class="sourceLine" id="cb21-4" data-line-number="4">Longitude &lt;-<span class="st"> </span><span class="kw">equal.count</span>(Lon,<span class="dv">2</span>,.<span class="dv">25</span>)</a>
<a class="sourceLine" id="cb21-5" data-line-number="5"></a>
<a class="sourceLine" id="cb21-6" data-line-number="6"><span class="co"># January vs July Precipitation Ratios by Elevation</span></a>
<a class="sourceLine" id="cb21-7" data-line-number="7">plot2 &lt;-<span class="st"> </span><span class="kw">xyplot</span>(APJan <span class="op">~</span><span class="st"> </span>APJul <span class="op">|</span><span class="st"> </span>Elevation,</a>
<a class="sourceLine" id="cb21-8" data-line-number="8">    <span class="dt">layout =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">2</span>),</a>
<a class="sourceLine" id="cb21-9" data-line-number="9">    <span class="dt">panel =</span> <span class="cf">function</span>(x, y) {</a>
<a class="sourceLine" id="cb21-10" data-line-number="10">        <span class="kw">panel.grid</span>(<span class="dt">v=</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb21-11" data-line-number="11">        <span class="kw">panel.xyplot</span>(x, y)</a>
<a class="sourceLine" id="cb21-12" data-line-number="12">        <span class="kw">panel.loess</span>(x, y, <span class="dt">span =</span> <span class="fl">1.0</span>, <span class="dt">degree =</span> <span class="dv">1</span>, <span class="dt">family=</span><span class="st">&quot;symmetric&quot;</span>)</a>
<a class="sourceLine" id="cb21-13" data-line-number="13">        <span class="kw">panel.abline</span>(<span class="kw">lm</span>(y<span class="op">~</span>x))</a>
<a class="sourceLine" id="cb21-14" data-line-number="14">    },</a>
<a class="sourceLine" id="cb21-15" data-line-number="15">    <span class="dt">xlab =</span> <span class="st">&quot;APJul&quot;</span>,</a>
<a class="sourceLine" id="cb21-16" data-line-number="16">    <span class="dt">ylab =</span> <span class="st">&quot;APJan&quot;</span>)</a>
<a class="sourceLine" id="cb21-17" data-line-number="17"><span class="kw">print</span>(plot2, <span class="dt">position=</span><span class="kw">c</span>(<span class="dv">0</span>,.<span class="dv">375</span>,<span class="dv">1</span>,<span class="dv">1</span>), <span class="dt">more=</span>T)</a>
<a class="sourceLine" id="cb21-18" data-line-number="18"><span class="kw">print</span>(<span class="kw">plot</span>(Elevation), <span class="dt">position=</span><span class="kw">c</span>(.<span class="dv">1</span>,<span class="fl">0.0</span>,.<span class="dv">9</span>,.<span class="dv">4</span>))</a></code></pre></div>
<p><img src="lec05_files/figure-html/plot20-1.png" width="2100" /></p>
<p>The plot shows that the relationship between January and July precipitation indeed varies with elevation. At low elevations, there is proportionally lower January precipitation for the same July values (lower two panels on the lattice plot), but at higher elevations, there is proportionally more (top two panels). This relationship points to some orographic (i.e. related to the elevation of the mountains) amplification of the winter precipitation.</p>
<p>The next plot shows the variation of the relationship between January and July precipitation as it varies spatially.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" data-line-number="1"><span class="co"># January vs July Precipitation Ratios by Latitude and Longitude</span></a>
<a class="sourceLine" id="cb22-2" data-line-number="2">plot3 &lt;-<span class="st"> </span><span class="kw">xyplot</span>(APJan <span class="op">~</span><span class="st"> </span>APJul <span class="op">|</span><span class="st"> </span>Latitude<span class="op">*</span>Longitude,</a>
<a class="sourceLine" id="cb22-3" data-line-number="3">    <span class="dt">layout =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">2</span>),</a>
<a class="sourceLine" id="cb22-4" data-line-number="4">    <span class="dt">panel =</span> <span class="cf">function</span>(x, y) {</a>
<a class="sourceLine" id="cb22-5" data-line-number="5">        <span class="kw">panel.grid</span>(<span class="dt">v=</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb22-6" data-line-number="6">        <span class="kw">panel.xyplot</span>(x, y)</a>
<a class="sourceLine" id="cb22-7" data-line-number="7">        <span class="kw">panel.loess</span>(x, y, <span class="dt">span =</span> <span class="fl">.8</span>, <span class="dt">degree =</span> <span class="dv">1</span>, <span class="dt">family=</span><span class="st">&quot;gaussian&quot;</span>)</a>
<a class="sourceLine" id="cb22-8" data-line-number="8">        <span class="kw">panel.abline</span>(<span class="kw">lm</span>(y<span class="op">~</span>x))</a>
<a class="sourceLine" id="cb22-9" data-line-number="9">    },</a>
<a class="sourceLine" id="cb22-10" data-line-number="10">    <span class="dt">xlab =</span> <span class="st">&quot;APJul&quot;</span>,</a>
<a class="sourceLine" id="cb22-11" data-line-number="11">    <span class="dt">ylab =</span> <span class="st">&quot;APJan&quot;</span>)</a>
<a class="sourceLine" id="cb22-12" data-line-number="12"><span class="kw">print</span>(plot3)</a></code></pre></div>
<p><img src="lec05_files/figure-html/plot21-1.png" width="2100" /></p>
<p>Notice that the steepest curve lies in the panel representing the southwestern part of the region (low latitude and low longitude, i.e. the bottom left panel), which suggests that winter (January) precipitation is relatively more import there, which is also apparent on the stars plot above.</p>
<p>Next, the general idea that seems to be emerging, that there variations within the region of the relative importance of summer and winter precipitation can be explored by a parallel-coordinate plot, that allow different precipitation “regimes” to be detected by the appearance of distinct “bundles” of curves.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" data-line-number="1"><span class="co"># Parallel plot of precipitation ratios</span></a>
<a class="sourceLine" id="cb23-2" data-line-number="2">plot4 &lt;-<span class="st"> </span><span class="kw">parallelplot</span>(<span class="op">~</span>yellpratio[,<span class="dv">4</span><span class="op">:</span><span class="dv">15</span>] <span class="op">|</span><span class="st"> </span>Elevation,</a>
<a class="sourceLine" id="cb23-3" data-line-number="3">    <span class="dt">layout =</span> <span class="kw">c</span>(<span class="dv">4</span>, <span class="dv">1</span>),</a>
<a class="sourceLine" id="cb23-4" data-line-number="4">    <span class="dt">ylab =</span> <span class="st">&quot;Precipitation Ratios&quot;</span>)</a>
<a class="sourceLine" id="cb23-5" data-line-number="5"><span class="kw">print</span>(plot4)</a></code></pre></div>
<p><img src="lec05_files/figure-html/plot22-1.png" width="2100" /></p>
<p>Notice that at low elevations, most of the stations are behaving similarly, and showing a distinct summer precipitation maximum (and only one station seems to show a winter maximum). At high elevations, there is more variability but a general tendency for winter precipitation to dominate.</p>
<p>Lattice plots can extend many of the basic univariate and bivariate plots. For example, a set of scatter plot matrices can be generated, for the high/low latitude and longitude slices.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" data-line-number="1"><span class="co"># Lattice plot of scatter plot matrices</span></a>
<a class="sourceLine" id="cb24-2" data-line-number="2">plot5 &lt;-<span class="st"> </span><span class="kw">splom</span>(<span class="op">~</span><span class="kw">cbind</span>(APJan,APJul,Elev) <span class="op">|</span><span class="st"> </span>Latitude<span class="op">*</span>Longitude)</a>
<a class="sourceLine" id="cb24-3" data-line-number="3"><span class="kw">print</span>(plot5)</a></code></pre></div>
<p><img src="lec05_files/figure-html/plot23-1.png" width="2100" /></p>
<p>These plots provide a different prospective on the variations of precipitation across the region, but they’re consistent with what the other plots show.</p>
<p>#Lattice-like plots of maps (<code>spplot()</code>)#</p>
<p>The <code>spplot()</code> function in the <code>sp</code> package is a Lattice-plot type method, and can be thought of as either extending the capabilities of Lattice plots to maps, or extending the ability of R to produce multi-panel maps.</p>
<p>The following example uses a data set of locations and elevations Oregon cirque basins (upland basins eroded by glaciers), and whether or not they are currently (early 21st century) glaciated. Whether a cirque is occupied by a glacier or not is basically determined by the trade-off between snow accumulation (and hence winter precipitation) and summer ablation (or melting, and hence summer temperature. Cirque basins not currently occupied by glaciers were, of course, occupied in the past, while those occupied today indicate where “glacier-safe” climate prevails (at least for now).</p>
<p>In the code below, the two <code>as.factor()</code> functions are used to turn the single variable <code>cirques.shp$Glacier</code>, which has the values “<code>G</code>” and “<code>U</code>”, into two “binary” (0 or 1) variables. The variable <code>cirques.shp$Glaciated</code> will contain 1’s for glaciated cirques, and 0 otherwise (i.e. unglaciated cirques), while the variable <code>cirques.shp$Unglaciated</code> will contain 1’s for unglaciated cirques, and 0 otherwise. The two variables are obviously redundant (the elements would sum to 1 for each observation), but it makes the illustration of the method more transparent.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" data-line-number="1"><span class="co"># multi-panel lattice plot</span></a>
<a class="sourceLine" id="cb25-2" data-line-number="2">cirques.shp<span class="op">$</span>Glaciated &lt;-<span class="st"> </span><span class="kw">as.factor</span>(<span class="kw">ifelse</span>(cirques.shp<span class="op">$</span>Glacier<span class="op">==</span><span class="st">&quot;G&quot;</span>,<span class="dv">1</span>,<span class="dv">0</span>))</a>
<a class="sourceLine" id="cb25-3" data-line-number="3">cirques.shp<span class="op">$</span>Unglaciated &lt;-<span class="st"> </span><span class="kw">as.factor</span>(<span class="kw">ifelse</span>(cirques.shp<span class="op">$</span>Glacier<span class="op">==</span><span class="st">&quot;U&quot;</span>,<span class="dv">1</span>,<span class="dv">0</span>))</a>
<a class="sourceLine" id="cb25-4" data-line-number="4">basemap &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="st">&quot;sp.lines&quot;</span>, orotl.shp, <span class="dt">fill=</span><span class="ot">NA</span>)</a>
<a class="sourceLine" id="cb25-5" data-line-number="5"></a>
<a class="sourceLine" id="cb25-6" data-line-number="6"><span class="kw">spplot</span>(cirques.shp, <span class="kw">c</span>(<span class="st">&quot;Glaciated&quot;</span>,<span class="st">&quot;Unglaciated&quot;</span>),</a>
<a class="sourceLine" id="cb25-7" data-line-number="7">  <span class="dt">col.regions=</span><span class="kw">brewer.pal</span>(<span class="dv">8</span>,<span class="st">&quot;Set3&quot;</span>),</a>
<a class="sourceLine" id="cb25-8" data-line-number="8">  <span class="dt">sp.layout=</span><span class="kw">list</span>(basemap),</a>
<a class="sourceLine" id="cb25-9" data-line-number="9">  <span class="dt">xlim=</span><span class="kw">c</span>(<span class="op">-</span><span class="dv">125</span>,<span class="op">-</span><span class="dv">115</span>), <span class="dt">ylim=</span><span class="kw">c</span>(<span class="dv">41</span>, <span class="dv">47</span>),</a>
<a class="sourceLine" id="cb25-10" data-line-number="10">  <span class="dt">pch=</span><span class="dv">19</span>, <span class="dt">aspect=</span><span class="kw">cos</span>((<span class="dv">45</span><span class="op">/</span><span class="dv">360</span>)<span class="op">*</span>(<span class="dv">2</span><span class="op">*</span>pi)),</a>
<a class="sourceLine" id="cb25-11" data-line-number="11">  <span class="dt">scales=</span><span class="kw">list</span>(<span class="dt">draw=</span>T), <span class="dt">key.space=</span><span class="st">&quot;right&quot;</span>)</a></code></pre></div>
<p><img src="lec05_files/figure-html/plot24-1.png" width="2100" /></p>
<p>The top panel shows unglaciated cirques in pink and glaciated ones in turquoise, while the bottom panel shows the reverse, glaciated cirques in pink, unglaciated in turquoise. Note the <code>aspect</code> argument – this scales the horizontal and vertical axes of the plot in a way that makes the map look projected.</p>
<p>It’s pretty easy to see where the glaciated cirques occur.</p>
<p>This way of mapping the cirques could also have been done by plotting a simple shape file, and then putting points on top, e.g.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb26-1" data-line-number="1"><span class="kw">plot</span>(orotl.shp)</a>
<a class="sourceLine" id="cb26-2" data-line-number="2"><span class="kw">points</span>(cirques.shp<span class="op">$</span>Lon, cirques.shp<span class="op">$</span>Lat, <span class="dt">col=</span><span class="dv">3</span><span class="op">-</span><span class="kw">as.integer</span>(cirques.shp<span class="op">$</span>Glacier))</a>
<a class="sourceLine" id="cb26-3" data-line-number="3"><span class="kw">legend</span>(<span class="op">-</span><span class="dv">118</span>, <span class="fl">43.5</span>, <span class="kw">c</span>(<span class="st">&quot;Glaciated&quot;</span>,<span class="st">&quot;Unglaciated&quot;</span>), <span class="dt">pch=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>), <span class="dt">col=</span><span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">1</span>))</a></code></pre></div>
<p><img src="lec05_files/figure-html/plot25-1.png" width="2100" /></p>
<p>Finally, here are some multi- and single-panel plots of climate-station data, the interpretation of which is straightforward.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" data-line-number="1"><span class="co"># lattice-type plots of climate-station data</span></a>
<a class="sourceLine" id="cb27-2" data-line-number="2">nclr &lt;-<span class="st"> </span><span class="dv">8</span></a>
<a class="sourceLine" id="cb27-3" data-line-number="3">plotclr &lt;-<span class="st"> </span><span class="kw">brewer.pal</span>(nclr,<span class="st">&quot;RdBu&quot;</span>)</a>
<a class="sourceLine" id="cb27-4" data-line-number="4">plotclr &lt;-<span class="st"> </span>plotclr[nclr<span class="op">:</span><span class="dv">1</span>] <span class="co"># reorder colors if appropriate</span></a>
<a class="sourceLine" id="cb27-5" data-line-number="5"></a>
<a class="sourceLine" id="cb27-6" data-line-number="6">basemap &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="st">&quot;sp.lines&quot;</span>, orotl.shp, <span class="dt">fill=</span><span class="ot">NA</span>)</a>
<a class="sourceLine" id="cb27-7" data-line-number="7">cuts=<span class="kw">c</span>(<span class="op">-</span><span class="dv">30</span>,<span class="op">-</span><span class="dv">25</span>,<span class="op">-</span><span class="dv">20</span>,<span class="op">-</span><span class="dv">15</span>,<span class="op">-</span><span class="fl">10.</span>,<span class="op">-</span><span class="dv">5</span>,<span class="dv">0</span>,<span class="dv">5</span>,<span class="dv">10</span>,<span class="dv">15</span>,<span class="dv">20</span>,<span class="dv">25</span>,<span class="dv">30</span>)</a>
<a class="sourceLine" id="cb27-8" data-line-number="8"></a>
<a class="sourceLine" id="cb27-9" data-line-number="9"><span class="kw">spplot</span>(orstations.shp, <span class="kw">c</span>(<span class="st">&quot;tjul&quot;</span>, <span class="st">&quot;tjan&quot;</span>), <span class="dt">col.regions=</span>plotclr,</a>
<a class="sourceLine" id="cb27-10" data-line-number="10">     <span class="dt">sp.layout=</span><span class="kw">list</span>(basemap), <span class="dt">cuts=</span>cuts,</a>
<a class="sourceLine" id="cb27-11" data-line-number="11">     <span class="dt">pch=</span><span class="dv">19</span>, <span class="dt">cex=</span><span class="fl">1.5</span>, <span class="dt">aspect=</span><span class="kw">cos</span>((<span class="dv">45</span><span class="op">/</span><span class="dv">360</span>)<span class="op">*</span>(<span class="dv">2</span><span class="op">*</span>pi)),</a>
<a class="sourceLine" id="cb27-12" data-line-number="12">     <span class="dt">scales=</span><span class="kw">list</span>(<span class="dt">draw=</span>T), <span class="dt">key.space=</span><span class="st">&quot;right&quot;</span>,</a>
<a class="sourceLine" id="cb27-13" data-line-number="13">     <span class="dt">main=</span><span class="st">&quot;Temperature&quot;</span></a>
<a class="sourceLine" id="cb27-14" data-line-number="14">     )</a></code></pre></div>
<p><img src="lec05_files/figure-html/plot26-1.png" width="2100" /></p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb28-1" data-line-number="1"><span class="kw">spplot</span>(orstations.shp, <span class="kw">c</span>(<span class="st">&quot;tann&quot;</span>), <span class="dt">col.regions=</span>plotclr,</a>
<a class="sourceLine" id="cb28-2" data-line-number="2">     <span class="dt">sp.layout=</span><span class="kw">list</span>(basemap), <span class="dt">cuts=</span>cuts,</a>
<a class="sourceLine" id="cb28-3" data-line-number="3">     <span class="dt">pch=</span><span class="dv">19</span>, <span class="dt">cex=</span><span class="fl">1.5</span>, <span class="dt">aspect=</span><span class="kw">cos</span>((<span class="dv">45</span><span class="op">/</span><span class="dv">360</span>)<span class="op">*</span>(<span class="dv">2</span><span class="op">*</span>pi)),</a>
<a class="sourceLine" id="cb28-4" data-line-number="4">     <span class="dt">scales=</span><span class="kw">list</span>(<span class="dt">draw=</span>T), <span class="dt">key.space=</span><span class="st">&quot;right&quot;</span>,</a>
<a class="sourceLine" id="cb28-5" data-line-number="5">     <span class="dt">main=</span><span class="st">&quot;Mean July Temperature&quot;</span></a>
<a class="sourceLine" id="cb28-6" data-line-number="6">     )</a></code></pre></div>
<p><img src="lec05_files/figure-html/plot27-1.png" width="2100" /></p>
<p>The main documentation for Trellis graphics includes:</p>
<ul>
<li><a href="https://pjbartlein.github.io/GeogDataAnalysis/pdfs/trellis.user.pdf">Trellis Graphics User Manual</a>, and</li>
<li><a href="https://pjbartlein.github.io/GeogDataAnalysis/pdfs/Trellis_tour.pdf">A Tour of Trellis Graphics</a></li>
</ul>
<p>two .pdf documents published by the developers of the S language and Trellis Graphics, Lucent Technology.</p>
<p><a href="lec05.html">[Back to top]</a></p>
<p>#Readings#</p>
<ul>
<li>Kuhnert &amp; Venebles (An Introduction…): p. 86-96, 179-201;<br />
</li>
<li>Rossiter (Introduction … ITC): sections 5.1 and 5.2.</li>
</ul>
</div>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
