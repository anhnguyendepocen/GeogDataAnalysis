<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>Data wrangling and matrix algebra</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #0000ff; } /* Keyword */
code > span.ch { color: #008080; } /* Char */
code > span.st { color: #008080; } /* String */
code > span.co { color: #008000; } /* Comment */
code > span.ot { color: #ff4000; } /* Other */
code > span.al { color: #ff0000; } /* Alert */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #008000; font-weight: bold; } /* Warning */
code > span.cn { } /* Constant */
code > span.sc { color: #008080; } /* SpecialChar */
code > span.vs { color: #008080; } /* VerbatimString */
code > span.ss { color: #008080; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { } /* Variable */
code > span.cf { color: #0000ff; } /* ControlFlow */
code > span.op { } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #ff4000; } /* Preprocessor */
code > span.do { color: #008000; } /* Documentation */
code > span.an { color: #008000; } /* Annotation */
code > span.cv { color: #008000; } /* CommentVar */
code > span.at { } /* Attribute */
code > span.in { color: #008000; } /* Information */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' || rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="SI-md-08.css" type="text/css" />

</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<div class="container-fluid main-container">

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->





<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Geographic Data Analysis</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="overview.html">Overview</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Topics
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Lecture topics</li>
    <li>
      <a href="lec01.html">Introduction to the course</a>
    </li>
    <li>
      <a href="lec02.html">Univariate plots</a>
    </li>
    <li>
      <a href="lec03.html">Bivariate plots</a>
    </li>
    <li>
      <a href="lec04.html">Descriptive statistics</a>
    </li>
    <li>
      <a href="lec05.html">Multivariate plots</a>
    </li>
    <li>
      <a href="lec06.html">Maps in R</a>
    </li>
    <li>
      <a href="lec07.html">Geospatial analysis in R</a>
    </li>
    <li>
      <a href="lec08.html">Data wrangling and matrix algebra</a>
    </li>
    <li>
      <a href="lec09.html">Reference distributions</a>
    </li>
    <li>
      <a href="lec10.html">Statistical inference</a>
    </li>
    <li>
      <a href="lec11.html">Analysis of variance</a>
    </li>
    <li>
      <a href="lec12.html">Regression analysis</a>
    </li>
    <li>
      <a href="lec13.html">More regression analysis</a>
    </li>
    <li>
      <a href="lec14.html">Nonparametric regression</a>
    </li>
    <li>
      <a href="lec15.html">GLMs, GAMs, and CARTs</a>
    </li>
    <li>
      <a href="lec16.html">Principal components and factor analyses</a>
    </li>
    <li>
      <a href="lec17.html">MANOVA and discriminant analysis</a>
    </li>
    <li>
      <a href="lec18.html">Multivariate distances and cluster analysis</a>
    </li>
    <li>
      <a href="lec19.html">High-resolution and high-dimension data</a>
    </li>
    <li>
      <a href="lec20.html">Analysis and visualization of large raster data sets</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Exercises &amp; Exams
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Exercises</li>
    <li>
      <a href="ex01.html">Exercise 01 -- Getting R and RStudio</a>
    </li>
    <li>
      <a href="ex02.html">Exercise 02 -- Univariate plots</a>
    </li>
    <li>
      <a href="ex03.html">Exercise 03 -- Bivariate plots and descriptive statistics</a>
    </li>
    <li>
      <a href="ex04.html">Exercise 04 -- Multivariate plots</a>
    </li>
    <li>
      <a href="ex05.html">Exercise 05 -- Data wrangling and matrix algebra</a>
    </li>
    <li>
      <a href="ex06.html">Exercise 06 -- CI's, t-tests, ANOVA</a>
    </li>
    <li>
      <a href="ex07.html">Exercise 07 -- Regression analysis</a>
    </li>
    <li>
      <a href="ex08.html">Exercise 08 -- Multivariate analysis</a>
    </li>
    <li class="dropdown-header">Exams</li>
    <li>
      <a href="exam1_2018.html">Exam 1</a>
    </li>
    <li>
      <a href="exam2_2018.html">Exam 2</a>
    </li>
    <li class="dropdown-header">Other materials</li>
    <li>
      <a href="packages-and-data.html">Packages and Data</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Resources
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="readings.html">Readings</a>
    </li>
    <li>
      <a href="oldpages.html">Old course web pages</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="about.html">About</a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Data wrangling and matrix algebra</h1>

</div>

<div id="TOC">
<ul>
<li><a href="#introduction"><span class="toc-section-number">1</span> Introduction</a></li>
<li><a href="#data-wrangling"><span class="toc-section-number">2</span> Data wrangling</a><ul>
<li><a href="#example-data"><span class="toc-section-number">2.1</span> Example data</a><ul>
<li><a href="#variables"><span class="toc-section-number">2.1.1</span> Variables</a></li>
</ul></li>
<li><a href="#read-the-data"><span class="toc-section-number">2.2</span> Read the data</a></li>
<li><a href="#reread-as-a-tibble"><span class="toc-section-number">2.3</span> Reread as a tibble</a></li>
</ul></li>
<li><a href="#a-data-wrangling-example"><span class="toc-section-number">3</span> A data-wrangling example</a><ul>
<li><a href="#reshaping-by-gathering"><span class="toc-section-number">3.1</span> Reshaping by gathering</a></li>
<li><a href="#reshape-the-whole-data-set"><span class="toc-section-number">3.2</span> Reshape the whole data set</a></li>
</ul></li>
<li><a href="#other-data-wrangling-tasks"><span class="toc-section-number">4</span> Other data-wrangling tasks</a><ul>
<li><a href="#summarization"><span class="toc-section-number">4.1</span> Summarization</a></li>
<li><a href="#the-pipe-operator"><span class="toc-section-number">4.2</span> The pipe operator</a></li>
<li><a href="#calculating-anomalies"><span class="toc-section-number">4.3</span> Calculating anomalies</a></li>
</ul></li>
<li><a href="#matrix-algebra"><span class="toc-section-number">5</span> Matrix algebra</a><ul>
<li><a href="#some-basic-matrix-definitions-in-r"><span class="toc-section-number">5.1</span> Some basic matrix definitions in R</a></li>
<li><a href="#matrix-operations"><span class="toc-section-number">5.2</span> Matrix operations</a></li>
<li><a href="#matrix-algebra-1"><span class="toc-section-number">5.3</span> Matrix algebra</a><ul>
<li><a href="#matrix-multiplication"><span class="toc-section-number">5.3.1</span> Matrix multiplication</a></li>
</ul></li>
<li><a href="#special-matrices"><span class="toc-section-number">5.4</span> Special matrices</a><ul>
<li><a href="#inverse-matrices"><span class="toc-section-number">5.4.1</span> Inverse matrices</a></li>
<li><a href="#eigenvectors-and-eigenvalues"><span class="toc-section-number">5.4.2</span> Eigenvectors and eigenvalues</a></li>
</ul></li>
</ul></li>
<li><a href="#readings"><span class="toc-section-number">6</span> Readings</a></li>
</ul>
</div>

<div id="introduction" class="section level1">
<h1><span class="header-section-number">1</span> Introduction</h1>
<p>This lecture focuses on two topics that underlie R’s facility for reading and analyzing data: 1) the facility for reading and transforming (i.e. <em>tidying</em>) data that may not initially be in standard “rectangular data set” form, and 2) the manipulation of arrays, vectors and matrices of data “under the hood” in the execution of various data-analysis routines. The first topic, which also has been termed “data wrangling” is also an element of the concept of “reproducible research” which aims at documenting the analysis steps and results with sufficient detail that they could be reproduced by others.</p>
<p>Often, data are available in a format that might be efficient for one reason or another, but may not be in the <em>tidy</em> arrangement of <em>variables</em> in columns and <em>observations</em> or <em>cases</em> in rows. Although it is possible to coerce such data into the standard rectangular or “data frame” layout, perhaps by using Excel or by simple cutting and pasting in a text editor, that approach may not be reproducible, in the sense of having a body of code that can be rerun on the same or similar data sets. By doing the reorganization or reshaping within R, and documenting the analysis using R Markdown, the specific steps involved in the reshaping of the data can be reproduced using that documented code. The tidying of data is supported by several packages that are elements of what Hadley Wickham (see the readings below) calls the “tidyverse” – these packages include <code>readr</code> (for reading various kind of text data), and <code>dplyr</code> and <code>tidyr</code> for manipulation.</p>
<p>The second topic <em>matrix algebra</em> can be thought of as an efficient way of documenting the specific manipulations of or operations on data that are used to develop specific data-analysis results, by representing those operations in a very efficient and elegant manner. It is also the case, however, that matrix algebra is used in an analytical (as well as representational) sense to develop the specific statistics and their properties that are produced during an analysis. This will be illustrated later for regression and multivariate analysis.</p>
</div>
<div id="data-wrangling" class="section level1">
<h1><span class="header-section-number">2</span> Data wrangling</h1>
<div id="example-data" class="section level2">
<h2><span class="header-section-number">2.1</span> Example data</h2>
<p>A simple example of data wrangling, or the reshaping of non-rectangular data set into a rectangular one, can be illustrated using a small sample of monthly climate data for Eugene. These data are not currently part of the <code>geog495.RData</code> workspace file, but can be dowloaded here:</p>
<ul>
<li><a href="https://pjbartlein.github.io/GeogDataAnalysis/data/csv/EugeneClim-short.csv">EugeneClim-short.csv</a> – Three years (2013-2015) of monthly climate data for Eugene;</li>
<li><a href="https://pjbartlein.github.io/GeogDataAnalysis/data/csv/EugeneClim-short-alt-tvars.csv">EugeneClim-short-alt-tvars.csv</a> – Temperature data for those three years in an alternative format that is not tidy (i.e. columns are months (or observations) and rows are variables); and</li>
<li><a href="https://pjbartlein.github.io/GeogDataAnalysis/data/csv/EugeneClim-short-alt-pvars.csv">EugeneClim-short-alt-pvars.csv</a> – Precipitation data, also in an alternative format.</li>
</ul>
<p>The full data set can be downloaded from here: <a href="ttp://geog.uoregon.edu/GeogR/data/csv/EugeneClim.csv">EugeneClim.csv</a></p>
<div id="variables" class="section level3">
<h3><span class="header-section-number">2.1.1</span> Variables</h3>
<p>The variables in the data set include:</p>
<ul>
<li>TMAX – Monthly/Annual Maximum Temperature. Average of daily maximum temperature</li>
<li>TMIN – Monthly/Annual Minimum Temperature. Average of daily minimum temperature</li>
<li>TAVG – Average Monthly/Annual Temperature. Computed by adding the unrounded monthly/annual maximum and minimum temperatures and dividing by 2.</li>
<li>EMXT – Extreme maximum temperature for month/year. Highest daily maximum temperature for the month/year.</li>
<li>EMNT – Extreme minimum temperature for month/year. Lowest daily minimum</li>
<li>HTDD - Heating Degree Days. Computed when daily average temperature is less than 65 degrees Fahrenheit/18.3 degrees Celsius. HDD = 65(F)/18.3(C) – mean daily temperature. Each day is summed to produce a monthly/annual total.</li>
<li>CLDD - Cooling Degree Days. Computed when daily average temperature is more than 65 degrees Fahrenheit/18.3 degrees Celsius. CDD = mean daily temperature - 65 degrees Fahrenheit/18.3 degrees Celsius. Each day is summed to produce a monthly/annual total.</li>
<li>PRCP – Total Monthly/Annual Precipitation. Given in inches or millimeters depending on user specification.</li>
<li>EMXP – Highest daily total of precipitation in the month/year.</li>
<li>DP01 – Number of days with &gt;= 0.01 inch/0.254 millimeter in the month/year.</li>
<li>DP05 – Number of days with &gt;= 0.5 inch/12.7 millimeters in the month/year.</li>
<li>DP10 – Number of days with &gt;= 1.00 inch/25.4 millimeters in the month/year.</li>
<li>SNOW – Total Monthly/Annual Snowfall.</li>
<li>EMSD – Highest daily snow depth in the month/year</li>
<li>AWND – Monthly/Annual Average Wind Speed.</li>
</ul>
<p>(Variable names in the files are in lower case.)</p>
</div>
</div>
<div id="read-the-data" class="section level2">
<h2><span class="header-section-number">2.2</span> Read the data</h2>
<p>The “short” (3-year) data set can be read in the conventional way, as a <code>data.frame</code> object:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># read the .csv file conventionally</span>
csv_file &lt;-<span class="st"> &quot;/Users/bartlein/Projects/geog495/data/csv/EugeneClim-short.csv&quot;</span>
eugclim_df &lt;-<span class="st"> </span><span class="kw">read.csv</span>(csv_file) </code></pre></div>
<p>Notice the name of the function that was used to read the <code>.csv</code> file: <code>read.csv()</code>.</p>
<p>The <code>class()</code> and <code>str()</code> functions can be used to figure out the kind and format of the data:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">class</span>(eugclim_df)</code></pre></div>
<pre><code>## [1] &quot;data.frame&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str</span>(eugclim_df)</code></pre></div>
<pre><code>## &#39;data.frame&#39;:    36 obs. of  18 variables:
##  $ year: int  2013 2013 2013 2013 2013 2013 2013 2013 2013 2013 ...
##  $ mon : int  1 2 3 4 5 6 7 8 9 10 ...
##  $ yrmn: num  2013 2013 2013 2013 2013 ...
##  $ tmax: num  5.7 10.2 14.5 17 21.1 25 30.6 28.6 23.1 16.5 ...
##  $ tmin: num  -0.4 2.3 3 4.6 6.9 9.8 10.8 12.7 11.9 3.9 ...
##  $ tavg: num  2.6 6.3 8.7 10.8 14 17.4 20.7 20.7 17.5 10.2 ...
##  $ emxt: num  13.3 13.9 22.2 25.6 30 35.6 35.6 35 32.2 25.6 ...
##  $ emnt: num  -6.7 -2.8 -2.2 -0.5 1.1 4.4 6.1 7.8 5 -2.1 ...
##  $ htdd: num  487 338 298 226 137 ...
##  $ cldd: num  0 0 0 0 2.5 25.3 77.7 79.2 33.1 0 ...
##  $ prcp: num  34.5 41 54.2 36.8 51.7 ...
##  $ emxp: num  6.4 11.2 12.7 11.9 13 18.3 0 3.8 48.3 8.4 ...
##  $ dp01: int  11 14 12 10 13 7 0 4 15 6 ...
##  $ dp05: int  0 0 1 0 1 1 0 0 6 0 ...
##  $ dp10: int  0 0 0 0 0 0 0 0 1 0 ...
##  $ snow: int  NA NA NA NA NA 0 0 0 NA NA ...
##  $ emsd: int  NA NA NA 0 0 0 0 0 0 0 ...
##  $ awnd: num  1.9 2.6 2.2 2.7 3.1 2.5 3.4 2.5 3.2 1.7 ...</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">eugclim_df</code></pre></div>
<pre><code>##    year mon     yrmn tmax tmin tavg emxt  emnt  htdd  cldd  prcp emxp dp01 dp05 dp10 snow emsd awnd
## 1  2013   1 2013.000  5.7 -0.4  2.6 13.3  -6.7 486.9   0.0  34.5  6.4   11    0    0   NA   NA  1.9
## 2  2013   2 2013.083 10.2  2.3  6.3 13.9  -2.8 337.9   0.0  41.0 11.2   14    0    0   NA   NA  2.6
## 3  2013   3 2013.167 14.5  3.0  8.7 22.2  -2.2 298.1   0.0  54.2 12.7   12    1    0   NA   NA  2.2
## 4  2013   4 2013.250 17.0  4.6 10.8 25.6  -0.5 225.7   0.0  36.8 11.9   10    0    0   NA    0  2.7
## 5  2013   5 2013.333 21.1  6.9 14.0 30.0   1.1 137.1   2.5  51.7 13.0   13    1    0   NA    0  3.1
## 6  2013   6 2013.417 25.0  9.8 17.4 35.6   4.4  54.0  25.3  28.1 18.3    7    1    0    0    0  2.5
## 7  2013   7 2013.500 30.6 10.8 20.7 35.6   6.1   4.5  77.7   0.0  0.0    0    0    0    0    0  3.4
## 8  2013   8 2013.583 28.6 12.7 20.7 35.0   7.8   7.1  79.2   6.4  3.8    4    0    0    0    0  2.5
## 9  2013   9 2013.667 23.1 11.9 17.5 32.2   5.0  57.0  33.1 179.8 48.3   15    6    1   NA    0  3.2
## 10 2013  10 2013.750 16.5  3.9 10.2 25.6  -2.1 251.7   0.0  14.8  8.4    6    0    0   NA    0  1.7
## 11 2013  11 2013.833 11.1  2.6  6.8 17.8  -7.1 345.5   0.0  54.2 10.9   14    0    0   NA   NA  2.4
## 12 2013  12 2013.917  4.9 -3.2  0.8 13.3 -23.2 542.6   0.0  37.7 15.5    8    2    0   NA    0  2.1
## 13 2014   1 2014.000  7.8  0.8  4.3 13.3  -4.3 435.5   0.0  65.4 17.5   11    2    0   NA    0  2.4
## 14 2014   2 2014.083  9.1  1.9  5.5 17.2  -6.6 359.9   0.0 202.6 34.3   22    6    3   NA  178  3.5
## 15 2014   3 2014.167 14.9  4.1  9.5 23.3  -2.1 273.3   0.0 165.9 25.7   19    6    1   NA    0  3.5
## 16 2014   4 2014.250 17.4  5.0 11.2 27.8   1.1 214.0   0.0  61.8 11.9   15    0    0   NA    0  3.2
## 17 2014   5 2014.333 21.7  7.3 14.5 31.1   1.7 118.7   1.1  41.8 11.4   12    0    0   NA    0  2.9
## 18 2014   6 2014.417 23.8  8.8 16.3 29.4   3.9  63.1   2.2  32.8 17.0    9    1    0    0    0  3.2
## 19 2014   7 2014.500 30.9 12.3 21.6 36.1   8.3   3.6 103.6   9.4  5.3    4    0    0    0    0  3.2
## 20 2014   8 2014.583 31.0 12.8 21.9 38.3   7.2   0.6 110.9   5.0  4.1    4    0    0    0    0  2.8
## 21 2014   9 2014.667 27.2 10.1 18.6 36.7   6.1  20.8  30.0  31.8 18.5    7    1    0    0    0  2.8
## 22 2014  10 2014.750 21.2  9.0 15.1 30.0   4.4 104.1   3.6 119.6 31.0   18    2    1   NA    0  2.9
## 23 2014  11 2014.833 11.3  3.2  7.2 19.4  -6.6 332.7   0.0 134.2 40.6   15    4    1   NA    0  3.1
## 24 2014  12 2014.917 10.0  3.6  6.8 16.7  -7.1 356.7   0.0 179.3 40.6   23    5    1   NA    0  2.9
## 25 2015   1 2015.000 10.4  2.6  6.5 20.0  -6.0 367.5   0.0  60.7 33.8   10    2    1   NA    0  1.9
## 26 2015   2 2015.083 13.8  4.2  9.0 18.3  -3.2 261.0   0.0 105.7 23.1   11    4    0   NA    0  2.9
## 27 2015   3 2015.167 17.0  4.0 10.5 22.2  -3.2 242.8   0.0  80.7 25.9   12    2    1   NA    0  2.5
## 28 2015   4 2015.250 16.6  3.0  9.8 25.0   0.6 255.2   0.0  37.4  7.4   12    0    0   NA    0  2.7
## 29 2015   5 2015.333 21.2  7.9 14.5 29.4   2.2 120.1   2.5  24.1  7.6   12    0    0   NA    0  2.4
## 30 2015   6 2015.417 28.7 10.4 19.5 36.7   5.0  24.8  60.8   5.8  5.3    2    0    0    0    0  3.3
## 31 2015   7 2015.500 31.2 12.6 21.9 40.6   8.3   3.1 114.9   1.4  0.8    3    0    0    0    0  3.4
## 32 2015   8 2015.583 29.9 12.2 21.0 37.8   7.2   1.7  85.3   5.8  3.0    2    0    0    0    0  3.3
## 33 2015   9 2015.667 25.0  8.1 16.6 33.9   3.3  69.8  16.4  19.5 11.9    8    0    0    0    0  3.0
## 34 2015  10 2015.750 21.4  7.6 14.5 28.9   0.6 121.5   2.5  62.1 28.7   11    1    1   NA    0  2.7
## 35 2015  11 2015.833 11.3  1.4  6.4 18.3  -8.2 359.4   0.0  71.2 16.8   16    1    0   NA    0  3.1
## 36 2015  12 2015.917  9.5  3.7  6.6 16.7  -4.3 363.7   0.0 345.5 41.9   26   11    4   NA    0  4.3</code></pre>
<p>The data are in a standard data frame, and it’s easy to see that these data are <em>tidy</em> in th sense of variables as columns, cases as rows.</p>
<p>An alternative (internal to R) format for data frames is provided by the <code>tibble</code> package and funcion. <code>tibbles</code> behave much the same as data frames, and can easily be transformed back and forth.</p>
<p>First, load the <code>tidyverse</code> package (install it if it’s not available):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># load library</span>
<span class="kw">library</span>(tidyverse)</code></pre></div>
<pre><code>## ── Attaching packages ───────────────────────────────────────────────────────────────────────────────────────────── tidyverse 1.2.1 ──</code></pre>
<pre><code>## ✔ ggplot2 2.2.1     ✔ purrr   0.2.4
## ✔ tibble  1.4.1     ✔ dplyr   0.7.4
## ✔ tidyr   0.7.2     ✔ stringr 1.2.0
## ✔ readr   1.1.1     ✔ forcats 0.2.0</code></pre>
<pre><code>## ── Conflicts ──────────────────────────────────────────────────────────────────────────────────────────────── tidyverse_conflicts() ──
## ✖ tidyr::extract() masks raster::extract()
## ✖ dplyr::filter()  masks stats::filter()
## ✖ dplyr::lag()     masks stats::lag()
## ✖ ggplot2::layer() masks latticeExtra::layer()
## ✖ purrr::map()     masks maps::map()
## ✖ dplyr::select()  masks raster::select()</code></pre>
<p>Note that loading the <code>tidyverse</code> library produces warnings about conflicts with other packages. Individual functions that are “masked” by packages or libraries loaded later can always be referenced by adding the package name. The following two statements are equivalent:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">median</span>(eugclim_df<span class="op">$</span>tavg)
stats<span class="op">::</span><span class="kw">median</span>(eugclim_df<span class="op">$</span>tavg)</code></pre></div>
</div>
<div id="reread-as-a-tibble" class="section level2">
<h2><span class="header-section-number">2.3</span> Reread as a tibble</h2>
<p>Now read the same file as a <code>tibble</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># reading using `readr` package</span>
eugclim &lt;-<span class="st"> </span><span class="kw">read_csv</span>(csv_file)</code></pre></div>
<pre><code>## Parsed with column specification:
## cols(
##   year = col_integer(),
##   mon = col_integer(),
##   yrmn = col_double(),
##   tmax = col_double(),
##   tmin = col_double(),
##   tavg = col_double(),
##   emxt = col_double(),
##   emnt = col_double(),
##   htdd = col_double(),
##   cldd = col_double(),
##   prcp = col_double(),
##   emxp = col_double(),
##   dp01 = col_integer(),
##   dp05 = col_integer(),
##   dp10 = col_integer(),
##   snow = col_integer(),
##   emsd = col_integer(),
##   awnd = col_double()
## )</code></pre>
<p>Notice here the name of the function used to read the <code>.csv</code> file (<code>read_csv()</code>), which superficially looks like the function <code>read.csv()</code> that was used earlier. Here’s the distinction:</p>
<ul>
<li><code>read.csv()</code> – read a <code>.csv</code> file as a <code>data.frame</code> object</li>
<li><code>read_csv()</code> – read a <code>.csv</code> file as a “<code>tibble</code>” (i.e. a <code>tbl_df</code> object)</li>
</ul>
<p>Take a look at the <code>tibble</code> version of the data:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">class</span>(eugclim)</code></pre></div>
<pre><code>## [1] &quot;tbl_df&quot;     &quot;tbl&quot;        &quot;data.frame&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">eugclim</code></pre></div>
<pre><code>## # A tibble: 36 x 18
##     year   mon  yrmn  tmax    tmin  tavg  emxt   emnt   htdd  cldd   prcp  emxp  dp01  dp05  dp10  snow
##    &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;
##  1  2013     1  2013  5.70 - 0.400  2.60  13.3 -6.70  487     0     34.5   6.40    11     0     0    NA
##  2  2013     2  2013 10.2    2.30   6.30  13.9 -2.80  338     0     41.0  11.2     14     0     0    NA
##  3  2013     3  2013 14.5    3.00   8.70  22.2 -2.20  298     0     54.2  12.7     12     1     0    NA
##  4  2013     4  2013 17.0    4.60  10.8   25.6 -0.500 226     0     36.8  11.9     10     0     0    NA
##  5  2013     5  2013 21.1    6.90  14.0   30.0  1.10  137     2.50  51.7  13.0     13     1     0    NA
##  6  2013     6  2013 25.0    9.80  17.4   35.6  4.40   54.0  25.3   28.1  18.3      7     1     0     0
##  7  2013     7  2014 30.6   10.8   20.7   35.6  6.10    4.50 77.7    0     0        0     0     0     0
##  8  2013     8  2014 28.6   12.7   20.7   35.0  7.80    7.10 79.2    6.40  3.80     4     0     0     0
##  9  2013     9  2014 23.1   11.9   17.5   32.2  5.00   57.0  33.1  180    48.3     15     6     1    NA
## 10  2013    10  2014 16.5    3.90  10.2   25.6 -2.10  252     0     14.8   8.40     6     0     0    NA
## # ... with 26 more rows, and 2 more variables: emsd &lt;int&gt;, awnd &lt;dbl&gt;</code></pre>
<p>Get a basic plot of the average monthly temperature (<code>tavg</code>); this is simiple, because each colunn of the <code>tibble</code> is a time series of the values for a particular variable. Note the ‘yrmn’ variable, which is a “decimal year” representation of the months in the record that facilitates plotting the data as a time series:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(eugclim<span class="op">$</span>tavg <span class="op">~</span><span class="st"> </span>eugclim<span class="op">$</span>yrmn, <span class="dt">type=</span><span class="st">&quot;o&quot;</span>, <span class="dt">pch=</span><span class="dv">16</span>, <span class="dt">xaxp=</span><span class="kw">c</span>(<span class="dv">2013</span>, <span class="dv">2016</span>, <span class="dv">3</span>))</code></pre></div>
<p><img src="lec08_files/figure-html/plot1-1.png" width="2100" /></p>
<p><a href="lec08.html">[Back to top]</a></p>
</div>
</div>
<div id="a-data-wrangling-example" class="section level1">
<h1><span class="header-section-number">3</span> A data-wrangling example</h1>
<p>An alternative way in which that Eugene climate data could have been laid out is one in which there are blocks of data, one per year, with months in columns, and individual variables in rows:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># alternative layout</span>
csv_file &lt;-<span class="st"> &quot;/Users/bartlein/Projects/geog495/data/csv/EugeneClim-short-alt-tvars.csv&quot;</span>
eugclim_alt &lt;-<span class="st"> </span><span class="kw">read_csv</span>(csv_file)</code></pre></div>
<pre><code>## Parsed with column specification:
## cols(
##   year = col_integer(),
##   param = col_character(),
##   `1` = col_double(),
##   `2` = col_double(),
##   `3` = col_double(),
##   `4` = col_double(),
##   `5` = col_double(),
##   `6` = col_double(),
##   `7` = col_double(),
##   `8` = col_double(),
##   `9` = col_double(),
##   `10` = col_double(),
##   `11` = col_double(),
##   `12` = col_double()
## )</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">eugclim_alt</code></pre></div>
<pre><code>## # A tibble: 15 x 14
##     year param     `1`    `2`    `3`     `4`   `5`   `6`   `7`   `8`   `9`    `10`   `11`    `12`
##    &lt;int&gt; &lt;chr&gt;   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;
##  1  2013 tmax    5.70   10.2   14.5   17.0   21.1  25.0  30.6  28.6  23.1   16.5    11.1    4.90 
##  2  2013 tmin  - 0.400   2.30   3.00   4.60   6.90  9.80 10.8  12.7  11.9    3.90    2.60 - 3.20 
##  3  2013 tavg    2.60    6.30   8.70  10.8   14.0  17.4  20.7  20.7  17.5   10.2     6.80   0.800
##  4  2013 emxt   13.3    13.9   22.2   25.6   30.0  35.6  35.6  35.0  32.2   25.6    17.8   13.3  
##  5  2013 emnt  - 6.70  - 2.80 - 2.20 - 0.500  1.10  4.40  6.10  7.80  5.00 - 2.10  - 7.10 -23.2  
##  6  2014 tmax    7.80    9.10  14.9   17.4   21.7  23.8  30.9  31.0  27.2   21.2    11.3   10.0  
##  7  2014 tmin    0.800   1.90   4.10   5.00   7.30  8.80 12.3  12.8  10.1    9.00    3.20   3.60 
##  8  2014 tavg    4.30    5.50   9.50  11.2   14.5  16.3  21.6  21.9  18.6   15.1     7.20   6.80 
##  9  2014 emxt   13.3    17.2   23.3   27.8   31.1  29.4  36.1  38.3  36.7   30.0    19.4   16.7  
## 10  2014 emnt  - 4.30  - 6.60 - 2.10   1.10   1.70  3.90  8.30  7.20  6.10   4.40  - 6.60 - 7.10 
## 11  2015 tmax   10.4    13.8   17.0   16.6   21.2  28.7  31.2  29.9  25.0   21.4    11.3    9.50 
## 12  2015 tmin    2.60    4.20   4.00   3.00   7.90 10.4  12.6  12.2   8.10   7.60    1.40   3.70 
## 13  2015 tavg    6.50    9.00  10.5    9.80  14.5  19.5  21.9  21.0  16.6   14.5     6.40   6.60 
## 14  2015 emxt   20.0    18.3   22.2   25.0   29.4  36.7  40.6  37.8  33.9   28.9    18.3   16.7  
## 15  2015 emnt  - 6.00  - 3.20 - 3.20   0.600  2.20  5.00  8.30  7.20  3.30   0.600 - 8.20 - 4.30</code></pre>
<p>This layout is obviously not “tidy”, but is not atypical of the way many data sets are provided. With considerable cutting and pasting in Excel (including transposing data using Paste &gt; Special) these data could be rearranged, but such editing is prone to mistakes, masks what has actually been done to the data, and is not easy to repeat.</p>
<div id="reshaping-by-gathering" class="section level2">
<h2><span class="header-section-number">3.1</span> Reshaping by gathering</h2>
<p>The data can be reshaped into the appropriate form using the <code>gather()</code> function in the <code>tidyr</code> package. To illustrate this, first make another data set that includes just the average temperature data (<code>tavg</code>) from the “untidy” version of the data:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># get just the tavg data</span>
eugclim_alt_tavg &lt;-<span class="st"> </span>eugclim_alt[eugclim_alt<span class="op">$</span>param <span class="op">==</span><span class="st"> &quot;tavg&quot;</span>, ]
eugclim_alt_tavg</code></pre></div>
<pre><code>## # A tibble: 3 x 14
##    year param   `1`   `2`   `3`   `4`   `5`   `6`   `7`   `8`   `9`  `10`  `11`  `12`
##   &lt;int&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1  2013 tavg   2.60  6.30  8.70 10.8   14.0  17.4  20.7  20.7  17.5  10.2  6.80 0.800
## 2  2014 tavg   4.30  5.50  9.50 11.2   14.5  16.3  21.6  21.9  18.6  15.1  7.20 6.80 
## 3  2015 tavg   6.50  9.00 10.5   9.80  14.5  19.5  21.9  21.0  16.6  14.5  6.40 6.60</code></pre>
<p>Then reshape the data using <code>gather()</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># reshape by gathering</span>
eugclim_alt_tavg2 &lt;-<span class="st"> </span><span class="kw">gather</span>(eugclim_alt_tavg, <span class="st">`</span><span class="dt">1</span><span class="st">`</span><span class="op">:</span><span class="st">`</span><span class="dt">12</span><span class="st">`</span>, <span class="dt">key=</span><span class="st">&quot;month&quot;</span>, <span class="dt">value=</span><span class="st">&quot;cases&quot;</span>)
eugclim_alt_tavg2</code></pre></div>
<pre><code>## # A tibble: 36 x 4
##     year param month cases
##    &lt;int&gt; &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt;
##  1  2013 tavg  1      2.60
##  2  2014 tavg  1      4.30
##  3  2015 tavg  1      6.50
##  4  2013 tavg  2      6.30
##  5  2014 tavg  2      5.50
##  6  2015 tavg  2      9.00
##  7  2013 tavg  3      8.70
##  8  2014 tavg  3      9.50
##  9  2015 tavg  3     10.5 
## 10  2013 tavg  4     10.8 
## # ... with 26 more rows</code></pre>
<p>The arguments of the <code>gather()</code> function include 1) the table to be reshaped (<code>eugclim_alt_tavg</code>), 2) the columns to be gathered together (here specified as <code>`1`:`12`</code> and note the use of the backtick (<code>`</code>) to indicate the columnn names, which in this example are character (<code>chr</code>) variables), 3) the “key” column that individual columns will be stacked up into, and 4) the values that will be stacked.</p>
<p>The observations are not quite in the right time-series order, but they can be sorted using the <code>arrange()</code> function from the <code>dplyr</code> package:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">eugclim_alt_tavg3 &lt;-<span class="st"> </span><span class="kw">arrange</span>(eugclim_alt_tavg2, year)
eugclim_alt_tavg3</code></pre></div>
<pre><code>## # A tibble: 36 x 4
##     year param month cases
##    &lt;int&gt; &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt;
##  1  2013 tavg  1      2.60
##  2  2013 tavg  2      6.30
##  3  2013 tavg  3      8.70
##  4  2013 tavg  4     10.8 
##  5  2013 tavg  5     14.0 
##  6  2013 tavg  6     17.4 
##  7  2013 tavg  7     20.7 
##  8  2013 tavg  8     20.7 
##  9  2013 tavg  9     17.5 
## 10  2013 tavg  10    10.2 
## # ... with 26 more rows</code></pre>
<p>Add a decimal year (<code>yrmn</code>) variable to the new data set, and plot.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">eugclim_alt_tavg3<span class="op">$</span>yrmn &lt;-<span class="st"> </span>eugclim_alt_tavg3<span class="op">$</span>year <span class="op">+</span><span class="st"> </span>(<span class="kw">as.integer</span>(eugclim_alt_tavg3<span class="op">$</span>month)<span class="op">-</span><span class="dv">1</span>)<span class="op">/</span><span class="dv">12</span>
<span class="kw">plot</span>(eugclim_alt_tavg3<span class="op">$</span>cases <span class="op">~</span><span class="st"> </span>eugclim_alt_tavg3<span class="op">$</span>yrmn, <span class="dt">type=</span><span class="st">&quot;o&quot;</span>, <span class="dt">pch=</span><span class="dv">16</span>, <span class="dt">col=</span><span class="st">&quot;blue&quot;</span>, <span class="dt">xaxp=</span><span class="kw">c</span>(<span class="dv">2013</span>, <span class="dv">2016</span>, <span class="dv">3</span>))</code></pre></div>
<p><img src="lec08_files/figure-html/plot%20tavg3-1.png" width="2100" /></p>
<p>Looks right.</p>
</div>
<div id="reshape-the-whole-data-set" class="section level2">
<h2><span class="header-section-number">3.2</span> Reshape the whole data set</h2>
<p>The whole alternative-layout data set can be reshaped by first gathering the data</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># alternative layout -- gather, then spread</span>
eugclim_alt2 &lt;-<span class="st"> </span><span class="kw">gather</span>(eugclim_alt, <span class="st">`</span><span class="dt">1</span><span class="st">`</span><span class="op">:</span><span class="st">`</span><span class="dt">12</span><span class="st">`</span>, <span class="dt">key=</span><span class="st">&quot;month&quot;</span>, <span class="dt">value=</span><span class="st">&quot;cases&quot;</span>)
eugclim_alt2</code></pre></div>
<pre><code>## # A tibble: 180 x 4
##     year param month   cases
##    &lt;int&gt; &lt;chr&gt; &lt;chr&gt;   &lt;dbl&gt;
##  1  2013 tmax  1       5.70 
##  2  2013 tmin  1     - 0.400
##  3  2013 tavg  1       2.60 
##  4  2013 emxt  1      13.3  
##  5  2013 emnt  1     - 6.70 
##  6  2014 tmax  1       7.80 
##  7  2014 tmin  1       0.800
##  8  2014 tavg  1       4.30 
##  9  2014 emxt  1      13.3  
## 10  2014 emnt  1     - 4.30 
## # ... with 170 more rows</code></pre>
<p>The month values, which are now characters (which just happen to be numerals here), can be recoded to integers as follows:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">eugclim_alt2<span class="op">$</span>month &lt;-<span class="st"> </span><span class="kw">as.integer</span>(eugclim_alt2<span class="op">$</span>month)</code></pre></div>
<p>Then the “tall” stack of data is spread into rectangular data set using the values in the <code>param</code> column:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">eugclim_alt3 &lt;-<span class="st"> </span><span class="kw">spread</span>(eugclim_alt2, <span class="dt">key=</span><span class="st">&quot;param&quot;</span>, <span class="dt">value=</span>cases)
eugclim_alt3</code></pre></div>
<pre><code>## # A tibble: 36 x 7
##     year month   emnt  emxt  tavg  tmax    tmin
##  * &lt;int&gt; &lt;int&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;
##  1  2013     1 -6.70   13.3  2.60  5.70 - 0.400
##  2  2013     2 -2.80   13.9  6.30 10.2    2.30 
##  3  2013     3 -2.20   22.2  8.70 14.5    3.00 
##  4  2013     4 -0.500  25.6 10.8  17.0    4.60 
##  5  2013     5  1.10   30.0 14.0  21.1    6.90 
##  6  2013     6  4.40   35.6 17.4  25.0    9.80 
##  7  2013     7  6.10   35.6 20.7  30.6   10.8  
##  8  2013     8  7.80   35.0 20.7  28.6   12.7  
##  9  2013     9  5.00   32.2 17.5  23.1   11.9  
## 10  2013    10 -2.10   25.6 10.2  16.5    3.90 
## # ... with 26 more rows</code></pre>
<p>Plot the reshaped data:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">eugclim_alt3<span class="op">$</span>yrmn &lt;-<span class="st"> </span>eugclim_alt3<span class="op">$</span>year <span class="op">+</span><span class="st"> </span>(<span class="kw">as.integer</span>(eugclim_alt3<span class="op">$</span>month)<span class="op">-</span><span class="dv">1</span>)<span class="op">/</span><span class="dv">12</span>
<span class="kw">plot</span>(eugclim_alt3<span class="op">$</span>tavg <span class="op">~</span><span class="st"> </span>eugclim_alt3<span class="op">$</span>yrmn, <span class="dt">type=</span><span class="st">&quot;o&quot;</span>, <span class="dt">pch=</span><span class="dv">16</span>, <span class="dt">col=</span><span class="st">&quot;red&quot;</span>, <span class="dt">xaxp=</span><span class="kw">c</span>(<span class="dv">2013</span>, <span class="dv">2016</span>, <span class="dv">3</span>))</code></pre></div>
<p><img src="lec08_files/figure-html/unnamed-chunk-2-1.png" width="2100" /> <a href="lec08.html">[Back to top]</a></p>
</div>
</div>
<div id="other-data-wrangling-tasks" class="section level1">
<h1><span class="header-section-number">4</span> Other data-wrangling tasks</h1>
<p>There are a number of other operations on a data table using the <code>dplyr</code> package (as well as base R) that can produce useful results.</p>
<div id="summarization" class="section level2">
<h2><span class="header-section-number">4.1</span> Summarization</h2>
<p>Summarize the whole data set. In this example, <code>summarize_all()</code> generates a long-term mean of the data.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># summarize</span>
eugclim_ltm &lt;-<span class="st"> </span><span class="kw">summarize_all</span>(eugclim, <span class="st">&quot;mean&quot;</span>)
eugclim_ltm</code></pre></div>
<pre><code>## # A tibble: 1 x 18
##    year   mon  yrmn  tmax  tmin  tavg  emxt   emnt  htdd  cldd  prcp  emxp  dp01  dp05  dp10  snow  emsd
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1  2014  6.50  2014  18.6  6.15  12.4  26.3 -0.331   201  20.9  66.9  17.3  11.1  1.64 0.417    NA    NA
## # ... with 1 more variable: awnd &lt;dbl&gt;</code></pre>
<p>Filter out just the January values, and get a long-term mean of those:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># filter</span>
eugclim_jan &lt;-<span class="st"> </span><span class="kw">filter</span>(eugclim, mon<span class="op">==</span><span class="dv">1</span>)
eugclim_jan</code></pre></div>
<pre><code>## # A tibble: 3 x 18
##    year   mon  yrmn  tmax   tmin  tavg  emxt  emnt  htdd  cldd  prcp  emxp  dp01  dp05  dp10  snow  emsd
##   &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;
## 1  2013     1  2013  5.70 -0.400  2.60  13.3 -6.70   487     0  34.5  6.40    11     0     0    NA    NA
## 2  2014     1  2014  7.80  0.800  4.30  13.3 -4.30   436     0  65.4 17.5     11     2     0    NA     0
## 3  2015     1  2015 10.4   2.60   6.50  20.0 -6.00   368     0  60.7 33.8     10     2     1    NA     0
## # ... with 1 more variable: awnd &lt;dbl&gt;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">eugclim_jan_ltm &lt;-<span class="st"> </span><span class="kw">summarize_all</span>(eugclim_jan, <span class="st">&quot;mean&quot;</span>)
eugclim_jan_ltm</code></pre></div>
<pre><code>## # A tibble: 1 x 18
##    year   mon  yrmn  tmax  tmin  tavg  emxt  emnt  htdd  cldd  prcp  emxp  dp01  dp05  dp10  snow  emsd
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1  2014  1.00  2014  7.97  1.00  4.47  15.5 -5.67   430     0  53.5  19.2  10.7  1.33 0.333    NA    NA
## # ... with 1 more variable: awnd &lt;dbl&gt;</code></pre>
<p>Summarize the data by groups, in this case by months. First rearrange the data, and then summarize:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># summarize by groups -- define groups</span>
eugclim_group &lt;-<span class="st"> </span><span class="kw">group_by</span>(eugclim, mon)
eugclim_group</code></pre></div>
<pre><code>## # A tibble: 36 x 18
## # Groups: mon [12]
##     year   mon  yrmn  tmax    tmin  tavg  emxt   emnt   htdd  cldd   prcp  emxp  dp01  dp05  dp10  snow
##    &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;
##  1  2013     1  2013  5.70 - 0.400  2.60  13.3 -6.70  487     0     34.5   6.40    11     0     0    NA
##  2  2013     2  2013 10.2    2.30   6.30  13.9 -2.80  338     0     41.0  11.2     14     0     0    NA
##  3  2013     3  2013 14.5    3.00   8.70  22.2 -2.20  298     0     54.2  12.7     12     1     0    NA
##  4  2013     4  2013 17.0    4.60  10.8   25.6 -0.500 226     0     36.8  11.9     10     0     0    NA
##  5  2013     5  2013 21.1    6.90  14.0   30.0  1.10  137     2.50  51.7  13.0     13     1     0    NA
##  6  2013     6  2013 25.0    9.80  17.4   35.6  4.40   54.0  25.3   28.1  18.3      7     1     0     0
##  7  2013     7  2014 30.6   10.8   20.7   35.6  6.10    4.50 77.7    0     0        0     0     0     0
##  8  2013     8  2014 28.6   12.7   20.7   35.0  7.80    7.10 79.2    6.40  3.80     4     0     0     0
##  9  2013     9  2014 23.1   11.9   17.5   32.2  5.00   57.0  33.1  180    48.3     15     6     1    NA
## 10  2013    10  2014 16.5    3.90  10.2   25.6 -2.10  252     0     14.8   8.40     6     0     0    NA
## # ... with 26 more rows, and 2 more variables: emsd &lt;int&gt;, awnd &lt;dbl&gt;</code></pre>
<p>Note that grouped data set looks almost exactly like the ungrouped one, except when listed, it includes the mention of the grouping variable (i.e., <code>Groups: mon [12]</code>).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># summarize groups</span>
eugclim_summary &lt;-<span class="st"> </span><span class="kw">summarize_all</span>(eugclim_group, <span class="kw">funs</span>(mean))
eugclim_summary</code></pre></div>
<pre><code>## # A tibble: 12 x 18
##      mon  year  yrmn  tmax  tmin  tavg  emxt    emnt   htdd  cldd   prcp  emxp  dp01  dp05  dp10  snow
##    &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1     1  2014  2014  7.97  1.00  4.47  15.5 - 5.67  430     0     53.5  19.2  10.7  1.33  0.333    NA
##  2     2  2014  2014 11.0   2.80  6.93  16.5 - 4.20  320     0    116    22.9  15.7  3.33  1.00     NA
##  3     3  2014  2014 15.5   3.70  9.57  22.6 - 2.50  271     0    100    21.4  14.3  3.00  0.667    NA
##  4     4  2014  2014 17.0   4.20 10.6   26.1   0.400 232     0     45.3  10.4  12.3  0     0        NA
##  5     5  2014  2014 21.3   7.37 14.3   30.2   1.67  125     2.03  39.2  10.7  12.3  0.333 0        NA
##  6     6  2014  2014 25.8   9.67 17.7   33.9   4.43   47.3  29.4   22.2  13.5   6.00 0.667 0         0
##  7     7  2014  2014 30.9  11.9  21.4   37.4   7.57    3.73 98.7    3.60  2.03  2.33 0     0         0
##  8     8  2014  2015 29.8  12.6  21.2   37.0   7.40    3.13 91.8    5.73  3.63  3.33 0     0         0
##  9     9  2014  2015 25.1  10.0  17.6   34.3   4.80   49.2  26.5   77.0  26.2  10.0  2.33  0.333    NA
## 10    10  2014  2015 19.7   6.83 13.3   28.2   0.967 159     2.03  65.5  22.7  11.7  1.00  0.667    NA
## 11    11  2014  2015 11.2   2.40  6.80  18.5 - 7.30  346     0     86.5  22.8  15.0  1.67  0.333    NA
## 12    12  2014  2015  8.13  1.37  4.73  15.6 -11.5   421     0    188    32.7  19.0  6.00  1.67     NA
## # ... with 2 more variables: emsd &lt;dbl&gt;, awnd &lt;dbl&gt;</code></pre>
<p>Calculate annual averages of each variable, using the <code>aggregate()</code> function from the <code>stats</code> package.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># aggregate</span>
eugclim_ann &lt;-<span class="st"> </span><span class="kw">aggregate</span>(eugclim, <span class="dt">by=</span><span class="kw">list</span>(eugclim<span class="op">$</span>year), <span class="dt">FUN=</span><span class="st">&quot;mean&quot;</span>)
eugclim_ann</code></pre></div>
<pre><code>##   Group.1 year mon     yrmn     tmax     tmin     tavg     emxt       emnt     htdd     cldd     prcp
## 1    2013 2013 6.5 2013.458 17.35833 5.408333 11.37500 25.00833 -1.6833333 229.0083 18.15000 44.93333
## 2    2014 2014 6.5 2014.458 18.85833 6.575000 12.70833 26.60833  0.5000000 190.2500 20.95000 87.46667
## 3    2015 2015 6.5 2015.458 19.66667 6.475000 13.06667 27.31667  0.1916667 182.5500 23.53333 68.32500
##       emxp     dp01      dp05       dp10 snow     emsd     awnd
## 1 13.36667  9.50000 0.9166667 0.08333333   NA       NA 2.525000
## 2 21.49167 13.25000 2.2500000 0.58333333   NA 14.83333 3.033333
## 3 17.18333 10.41667 1.7500000 0.58333333   NA  0.00000 2.958333</code></pre>
</div>
<div id="the-pipe-operator" class="section level2">
<h2><span class="header-section-number">4.2</span> The pipe operator</h2>
<p>Operations on a data table that require multiple steps can be streamlined both in appearance in the code and in the operations themselves using the “Pipe” operator (<code>%&gt;%</code>) from the <code>magrittr</code> package. The operator “pipes”, or moves forward, the output from one function to another.</p>
<p>Here’s a simple example, combining the grouping and summarization steps for calculating means by month.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># the pipe</span>
eugclim_summary &lt;-<span class="st"> </span>eugclim <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(mon) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarize_all</span>(<span class="kw">funs</span>(<span class="st">&quot;mean&quot;</span>))
eugclim_summary</code></pre></div>
<pre><code>## # A tibble: 12 x 18
##      mon  year  yrmn  tmax  tmin  tavg  emxt    emnt   htdd  cldd   prcp  emxp  dp01  dp05  dp10  snow
##    &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1     1  2014  2014  7.97  1.00  4.47  15.5 - 5.67  430     0     53.5  19.2  10.7  1.33  0.333    NA
##  2     2  2014  2014 11.0   2.80  6.93  16.5 - 4.20  320     0    116    22.9  15.7  3.33  1.00     NA
##  3     3  2014  2014 15.5   3.70  9.57  22.6 - 2.50  271     0    100    21.4  14.3  3.00  0.667    NA
##  4     4  2014  2014 17.0   4.20 10.6   26.1   0.400 232     0     45.3  10.4  12.3  0     0        NA
##  5     5  2014  2014 21.3   7.37 14.3   30.2   1.67  125     2.03  39.2  10.7  12.3  0.333 0        NA
##  6     6  2014  2014 25.8   9.67 17.7   33.9   4.43   47.3  29.4   22.2  13.5   6.00 0.667 0         0
##  7     7  2014  2014 30.9  11.9  21.4   37.4   7.57    3.73 98.7    3.60  2.03  2.33 0     0         0
##  8     8  2014  2015 29.8  12.6  21.2   37.0   7.40    3.13 91.8    5.73  3.63  3.33 0     0         0
##  9     9  2014  2015 25.1  10.0  17.6   34.3   4.80   49.2  26.5   77.0  26.2  10.0  2.33  0.333    NA
## 10    10  2014  2015 19.7   6.83 13.3   28.2   0.967 159     2.03  65.5  22.7  11.7  1.00  0.667    NA
## 11    11  2014  2015 11.2   2.40  6.80  18.5 - 7.30  346     0     86.5  22.8  15.0  1.67  0.333    NA
## 12    12  2014  2015  8.13  1.37  4.73  15.6 -11.5   421     0    188    32.7  19.0  6.00  1.67     NA
## # ... with 2 more variables: emsd &lt;dbl&gt;, awnd &lt;dbl&gt;</code></pre>
<p>What happens here is that the data table <code>eugclim</code>, is passed forward into the <code>group_by()</code> function, and the output from that is passed into the <code>summarize_all()</code> function. There is, of course, a tradeoff between the explicitness of doing one thing at a time, and the efficiency of a single line of code that performs multiple operations.</p>
</div>
<div id="calculating-anomalies" class="section level2">
<h2><span class="header-section-number">4.3</span> Calculating anomalies</h2>
<p>A common task in analyzing climate data is to convert the “absolute” values (i.e. the observations) into “anomalies” or deviations from some long-term mean (and note that “absolute values” here should not be confused with those unsigned values of a variable produced by the absolute-value operator <code>abs()</code>, e.g. |x|).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># anomalies</span>
eugclim<span class="op">$</span>tavg_anm &lt;-<span class="st"> </span>eugclim<span class="op">$</span>tavg <span class="op">-</span><span class="st"> </span>eugclim_summary<span class="op">$</span>tavg
eugclim<span class="op">$</span>tavg_anm</code></pre></div>
<pre><code>##  [1] -1.86666667 -0.63333333 -0.86666667  0.20000000 -0.33333333 -0.33333333 -0.70000000 -0.50000000
##  [9] -0.06666667 -3.06666667  0.00000000 -3.93333333 -0.16666667 -1.43333333 -0.06666667  0.60000000
## [17]  0.16666667 -1.43333333  0.20000000  0.70000000  1.03333333  1.83333333  0.40000000  2.06666667
## [25]  2.03333333  2.06666667  0.93333333 -0.80000000  0.16666667  1.76666667  0.50000000 -0.20000000
## [33] -0.96666667  1.23333333 -0.40000000  1.86666667</code></pre>
<p>Plot the anomalies.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(eugclim<span class="op">$</span>tavg_anm <span class="op">~</span><span class="st"> </span>eugclim<span class="op">$</span>yrmn, <span class="dt">type=</span><span class="st">&quot;o&quot;</span>, <span class="dt">pch=</span><span class="dv">16</span>, <span class="dt">col=</span><span class="st">&quot;green&quot;</span>, <span class="dt">xaxp=</span><span class="kw">c</span>(<span class="dv">2013</span>, <span class="dv">2016</span>, <span class="dv">3</span>))</code></pre></div>
<p><img src="lec08_files/figure-html/unnamed-chunk-5-1.png" width="2100" /></p>
<p><a href="lec08.html">[Back to top]</a></p>
</div>
</div>
<div id="matrix-algebra" class="section level1">
<h1><span class="header-section-number">5</span> Matrix algebra</h1>
<p>Matrix algebra provides an elegant way of representing both the data the kind of operations on tables or arrays that frequently come up in data analysis, and when implemented numerically, matrix algebra also provides efficient an means of carrying those operations out. The following is a brief introduction to matrix algebra as implmented in R.</p>
<p>A short dicussion of matrices in general, special matrices, and matrix operations can be found here: <a href="https://pjbartlein.github.io/GeogDataAnalysis/topics/matrix.pdf">matrix.pdf</a></p>
<div id="some-basic-matrix-definitions-in-r" class="section level2">
<h2><span class="header-section-number">5.1</span> Some basic matrix definitions in R</h2>
<p>Create the 3 row by 2 column matrix <strong>A</strong>. Note the use of the concatenation (<code>c()</code>) function to collect the individual matrix elements (the a<sub>ij</sub>’s) together, and the default fill order (<code>byrow = FALSE</code>), which implies filling the matrix by rows:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># create a matrix</span>
<span class="co"># default fill method: byrow = FALSE</span>
A &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">c</span>(<span class="dv">6</span>, <span class="dv">9</span>, <span class="dv">12</span>, <span class="dv">13</span>, <span class="dv">21</span>, <span class="dv">5</span>), <span class="dt">nrow=</span><span class="dv">3</span>, <span class="dt">ncol=</span><span class="dv">2</span>)
A</code></pre></div>
<pre><code>##      [,1] [,2]
## [1,]    6   13
## [2,]    9   21
## [3,]   12    5</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">class</span>(A)</code></pre></div>
<pre><code>## [1] &quot;matrix&quot;</code></pre>
<p>The <code>class()</code> function indicates that <strong>A</strong> is indeed a matrix (as opposed to a data frame).</p>
<p>Create another matrix, <strong>B</strong>, with the same elements, only filled by row this time:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># same elements, but byrow = TRUE</span>
B &lt;-<span class="st">  </span><span class="kw">matrix</span>(<span class="kw">c</span>(<span class="dv">6</span>, <span class="dv">9</span>, <span class="dv">12</span>, <span class="dv">13</span>, <span class="dv">21</span>, <span class="dv">5</span>), <span class="dt">nrow=</span><span class="dv">3</span>, <span class="dt">ncol=</span><span class="dv">2</span>, <span class="dt">byrow=</span><span class="ot">TRUE</span>)
B</code></pre></div>
<pre><code>##      [,1] [,2]
## [1,]    6    9
## [2,]   12   13
## [3,]   21    5</code></pre>
<p>Individual matrix elements can be reference using the “square-bracket selection” rules.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># referencing matrix elements</span>
A[<span class="dv">1</span>,<span class="dv">2</span>] <span class="co"># row 1, col 2</span></code></pre></div>
<pre><code>## [1] 13</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">A[<span class="dv">2</span>,<span class="dv">1</span>] <span class="co"># row 2, col 1</span></code></pre></div>
<pre><code>## [1] 9</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">A[<span class="dv">2</span>, ] <span class="co"># all elements in row 2</span></code></pre></div>
<pre><code>## [1]  9 21</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">A[, <span class="dv">2</span>] <span class="co"># all elements in column 2 ] </span></code></pre></div>
<pre><code>## [1] 13 21  5</code></pre>
<p>For comparison, create a vector <strong>c</strong>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># create a vector</span>
c &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>)
c</code></pre></div>
<pre><code>## [1] 1 2 3 4 5 6 7 8 9</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">class</span>(c)</code></pre></div>
<pre><code>## [1] &quot;numeric&quot;</code></pre>
<p>At this point, <strong>c</strong> is just a list of numbers. The <code>as.matrix()</code> function creates a 9 row by 1 column vector, which can be verified by the <code>dim()</code> function:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">c &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(c)
<span class="kw">class</span>(c)</code></pre></div>
<pre><code>## [1] &quot;matrix&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">dim</span>(c)</code></pre></div>
<pre><code>## [1] 9 1</code></pre>
<p>The vector <strong>c</strong> has 9 rows and 1 column.</p>
<p>A vector can be reshaped into a matrix:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># reshape the vector into a 3x3 matrix</span>
C &lt;-<span class="st"> </span><span class="kw">matrix</span>(c, <span class="dt">nrow=</span><span class="dv">3</span>, <span class="dt">ncol=</span><span class="dv">3</span>)
C</code></pre></div>
<pre><code>##      [,1] [,2] [,3]
## [1,]    1    4    7
## [2,]    2    5    8
## [3,]    3    6    9</code></pre>
<p>A vector can also be created from a single row or column of a matrix:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># create a vector from a column or row of a matrix</span>
a1 &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(A[, <span class="dv">1</span>]) <span class="co"># vector from column 1</span>
a1</code></pre></div>
<pre><code>##      [,1]
## [1,]    6
## [2,]    9
## [3,]   12</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">dim</span>(a1)</code></pre></div>
<pre><code>## [1] 3 1</code></pre>
<p><strong>a1</strong> is a 3 row by 1 column column vector.</p>
</div>
<div id="matrix-operations" class="section level2">
<h2><span class="header-section-number">5.2</span> Matrix operations</h2>
<p>Transposition (<code>t()</code>) flips the rows and columns of a matrix:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># transposition</span>
A</code></pre></div>
<pre><code>##      [,1] [,2]
## [1,]    6   13
## [2,]    9   21
## [3,]   12    5</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">t</span>(A)</code></pre></div>
<pre><code>##      [,1] [,2] [,3]
## [1,]    6    9   12
## [2,]   13   21    5</code></pre>
<p>A second example, the transpose of <strong>C</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">C</code></pre></div>
<pre><code>##      [,1] [,2] [,3]
## [1,]    1    4    7
## [2,]    2    5    8
## [3,]    3    6    9</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">t</span>(C)</code></pre></div>
<pre><code>##      [,1] [,2] [,3]
## [1,]    1    2    3
## [2,]    4    5    6
## [3,]    7    8    9</code></pre>
<p>Vectors and also be transposed, which simply turns a column vector, e.g. <strong>a1</strong> into a row vector</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">a1t &lt;-<span class="st"> </span><span class="kw">t</span>(a1)
a1t</code></pre></div>
<pre><code>##      [,1] [,2] [,3]
## [1,]    6    9   12</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">dim</span>(a1t)</code></pre></div>
<pre><code>## [1] 1 3</code></pre>
</div>
<div id="matrix-algebra-1" class="section level2">
<h2><span class="header-section-number">5.3</span> Matrix algebra</h2>
<p>Matrix algebra is basically analogous to scalar algebra (with the exception of division), and obeys most of the same rules that scalar algebra does.</p>
<p>Add two matrices, <strong>A</strong> and <strong>B</strong>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># addition</span>
F &lt;-<span class="st"> </span>A <span class="op">+</span><span class="st"> </span>B
F</code></pre></div>
<pre><code>##      [,1] [,2]
## [1,]   12   22
## [2,]   21   34
## [3,]   33   10</code></pre>
<p>Note that the individual elements of <strong>A</strong> and <strong>B</strong> are simply added together to produce the corresponding elements of <strong>F</strong> (i.e. f<sub>ij</sub> = a<sub>ij</sub> + b<sub>ij</sub>).</p>
<p>In order to be added together, the matrices have to be of the same shape (i.e. have the same number of rows and colums). The shape of a matrix can be verified using the <code>dim()</code> function:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">dim</span>(C)</code></pre></div>
<pre><code>## [1] 3 3</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">dim</span>(A)</code></pre></div>
<pre><code>## [1] 3 2</code></pre>
<p>Here, <strong>A</strong> and <strong>C</strong> are not the same shape, and the following code, if executed, would product an error message:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># A and C not same shape</span>
G &lt;-<span class="st"> </span>A <span class="op">+</span><span class="st"> </span>C</code></pre></div>
<p>Scalar multiplication involves muliplying each element of a matrix by a scalar value:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># scalar multiplication</span>
H &lt;-<span class="st"> </span><span class="fl">0.5</span><span class="op">*</span>A
H</code></pre></div>
<pre><code>##      [,1] [,2]
## [1,]  3.0  6.5
## [2,]  4.5 10.5
## [3,]  6.0  2.5</code></pre>
<p>Here, h<sub>ij</sub> = 0.5 · a<sub>ij</sub>. Element-by-element multiplication is also possible for identically shaped matrices, e.g., p<sub>ij</sub> = a<sub>ij</sub> · b<sub>ij</sub>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># element-by-element multipliction</span>
P &lt;-<span class="st"> </span>A<span class="op">*</span>B
P</code></pre></div>
<pre><code>##      [,1] [,2]
## [1,]   36  117
## [2,]  108  273
## [3,]  252   25</code></pre>
<div id="matrix-multiplication" class="section level3">
<h3><span class="header-section-number">5.3.1</span> Matrix multiplication</h3>
<p>Matrix multiplication (see <a href="https://pjbartlein.github.io/GeogDataAnalysis/topics/matrix.pdf">matrix.pdf</a>) results in a a set of sums and crossproducts, as opposed to element-by-element products. Matrix multiplication is symbolized by the <code>%*%</code> operator:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># matrix multiplication</span>
Q &lt;-<span class="st"> </span>C <span class="op">%*%</span><span class="st"> </span>A
Q</code></pre></div>
<pre><code>##      [,1] [,2]
## [1,]  126  132
## [2,]  153  171
## [3,]  180  210</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">dim</span>(C); <span class="kw">dim</span>(A)</code></pre></div>
<pre><code>## [1] 3 3</code></pre>
<pre><code>## [1] 3 2</code></pre>
<p>Note that the matrices have to be <em>conformable</em>, as they are here (the number of columns of the first matrix must equal the number of rows of the second, and the product matrix <strong>Q</strong> here has the number of rows of the first matrix and the number of columns of the second).</p>
<p>The matrices <strong>A</strong> and <strong>B</strong> are not conformable for multiplication; although they have the same shape, they are not square, and the following code would produce an error:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">T &lt;-<span class="st"> </span>A <span class="op">%*%</span><span class="st"> </span>B <span class="co"># not conformable</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">dim</span>(A); <span class="kw">dim</span>(B)</code></pre></div>
<pre><code>## [1] 3 2</code></pre>
<pre><code>## [1] 3 2</code></pre>
</div>
</div>
<div id="special-matrices" class="section level2">
<h2><span class="header-section-number">5.4</span> Special matrices</h2>
<p>There are a number of special matrices that come up in data analysis. Here <strong>D</strong> is a <em>diagonal</em> matrix, with non-zero values along the principal diagonal, and zeros elsewhere:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># diagonal matrix</span>
D &lt;-<span class="st"> </span><span class="kw">diag</span>(<span class="kw">c</span>(<span class="dv">6</span>,<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">3</span>), <span class="dt">nrow=</span><span class="dv">4</span>, <span class="dt">ncol=</span><span class="dv">4</span>)
D</code></pre></div>
<pre><code>##      [,1] [,2] [,3] [,4]
## [1,]    6    0    0    0
## [2,]    0    2    0    0
## [3,]    0    0    1    0
## [4,]    0    0    0    3</code></pre>
<p>A special form of a diagonal matrix is the identity matrix <strong>I</strong>, which has ones along the principal diagonal, and zeros elsewhere:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># identity matrix</span>
I &lt;-<span class="st"> </span><span class="kw">diag</span>(<span class="dv">1</span>, <span class="dt">nrow=</span><span class="dv">4</span>, <span class="dt">ncol=</span><span class="dv">4</span>)
I</code></pre></div>
<pre><code>##      [,1] [,2] [,3] [,4]
## [1,]    1    0    0    0
## [2,]    0    1    0    0
## [3,]    0    0    1    0
## [4,]    0    0    0    1</code></pre>
<p>A special <em>scalar</em> that appears often in practice is the <em>norm</em> (or <em>Euclidean norm</em>) of a vector, which is simply the square root of the sum of squares of the elements of the vector:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Euclidean norm of a vector</span>
anorm &lt;-<span class="st"> </span><span class="kw">sqrt</span>(<span class="kw">t</span>(a1) <span class="op">%*%</span><span class="st"> </span>a1)
anorm</code></pre></div>
<pre><code>##          [,1]
## [1,] 16.15549</code></pre>
<p>It can be verified that <code>sqrt(sum(a1^2))</code> = 16.1554944.</p>
<div id="inverse-matrices" class="section level3">
<h3><span class="header-section-number">5.4.1</span> Inverse matrices</h3>
<p>The matrix algebra equivalent of division is the multiplication of one matrix by the <em>inverse</em> of another. To illustrate this, and the topic of the <em>eigenstructure</em> of a matrix discussed below, we can look at a realistic matrix, the correlation matrix of the temperature variables in the Oregon climate-station data set.</p>
<p>Here’s the correlation matrix, <strong>R</strong>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># a realistic matrix, orstationc temperature-variable correlation matrix</span>
R &lt;-<span class="st"> </span><span class="kw">cor</span>(<span class="kw">cbind</span>(orstationc<span class="op">$</span>tjan, orstationc<span class="op">$</span>tjul, orstationc<span class="op">$</span>tann))
R</code></pre></div>
<pre><code>##            [,1]       [,2]      [,3]
## [1,]  1.0000000 -0.3639314 0.7253877
## [2,] -0.3639314  1.0000000 0.3641966
## [3,]  0.7253877  0.3641966 1.0000000</code></pre>
<p>The inverse of the correlation matrix <strong>R</strong>, written as <strong>R<sup>-1</sup></strong> is obtained using the <code>solve()</code> function:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># matrix inversion</span>
Rinv &lt;-<span class="st"> </span><span class="kw">solve</span>(R)
Rinv</code></pre></div>
<pre><code>##           [,1]      [,2]      [,3]
## [1,]  52.76560  38.21117 -52.19190
## [2,]  38.21117  28.82424 -38.21560
## [3,] -52.19190 -38.21560  52.77735</code></pre>
<p>As in scalar division, where <em>a</em> · (1/<em>a</em>) = 1.0, postmuliplying a matrix by its inverse yields the Identity matrix, <strong>I</strong>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># check inverse</span>
D &lt;-<span class="st"> </span>R <span class="op">%*%</span><span class="st"> </span>Rinv
D</code></pre></div>
<pre><code>##              [,1]         [,2]          [,3]
## [1,] 1.000000e+00 3.552714e-15  0.000000e+00
## [2,] 3.552714e-15 1.000000e+00 -7.105427e-15
## [3,] 7.105427e-15 7.105427e-15  1.000000e+00</code></pre>
<p>After rounding using the <code>zapsmall()</code> function <strong>D</strong> indeed equals <strong>I</strong>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">zapsmall</span>(D)</code></pre></div>
<pre><code>##      [,1] [,2] [,3]
## [1,]    1    0    0
## [2,]    0    1    0
## [3,]    0    0    1</code></pre>
</div>
<div id="eigenvectors-and-eigenvalues" class="section level3">
<h3><span class="header-section-number">5.4.2</span> Eigenvectors and eigenvalues</h3>
<p>An important concept that comes up in multivariate analysis is the <em>decomposition</em> of a matrix like the correlation matrix <strong>R</strong> (see <a href="https://pjbartlein.github.io/GeogDataAnalysis/topics/matrix.pdf">matrix.pdf</a>), into another square matrix, <strong>E</strong>, and a diagonal matrix, <strong>V</strong>, that each have some desireable properties, and which make the following statement true: <strong>RE</strong> = <strong>EV</strong>, where <strong>V</strong> is a diagonal matrix with the elements v<sub>i</sub> along the diagonal. The matrix <strong>E</strong> contains the <em>eigenvectors</em> of <strong>R</strong>, while the v<sub>i</sub>’s are the <em>eigenvalues</em> of <strong>R</strong>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># eigenvectors</span>
E &lt;-<span class="st"> </span><span class="kw">eigen</span>(R)
E</code></pre></div>
<pre><code>## eigen() decomposition
## $values
## [1] 1.725387748 1.267093364 0.007518887
## 
## $vectors
##            [,1]       [,2]       [,3]
## [1,] 0.70702003 -0.3258720 -0.6276385
## [2,] 0.00034552  0.8876651 -0.4604894
## [3,] 0.70719344  0.3253584  0.6277096</code></pre>
<p><a href="lec08.html">[Back to top]</a></p>
</div>
</div>
</div>
<div id="readings" class="section level1">
<h1><span class="header-section-number">6</span> Readings</h1>
<p>Data wrangling is nicely covered in the “preprint” version of the <em>R for Data Science</em> book by Wickham and Grolemund (2017), available at <a href="http://r4ds.had.co.nz" class="uri">http://r4ds.had.co.nz</a> or through the <em>Bookdown</em> web site at <a href="https://bookdown.org" class="uri">https://bookdown.org</a></p>
<p>The routines used in data wrangling are covered in the following cheatsheets from the RStudio web site:</p>
<ul>
<li><a href="https://github.com/rstudio/cheatsheets/raw/master/source/pdfs/data-import-cheatsheet.pdf">Data Import with <code>readr</code>, <code>tibble</code>, and <code>tidyr</code></a></li>
<li><a href="https://github.com/rstudio/cheatsheets/raw/master/source/pdfs/data-transformation-cheatsheet.pdf">Data Transformation with <code>dplyr</code></a></li>
<li><a href="https://www.rstudio.com/wp-content/uploads/2015/02/data-wrangling-cheatsheet.pdf">Data Wrangling with <code>dplyr</code> and <code>tidyr</code></a>, a previous version of the above.</li>
</ul>
<p>Matrix algebra is concisely reviewed in:</p>
<p>Rencher, A., 2002, Matrix Algebra, Ch. 2 in <em>Methods of Multivariate Analysis</em>, Wiley. The chapter (and book) is available online through <a href="http://library.uoregon.edu" class="uri">http://library.uoregon.edu</a>.</p>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
