<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>Exercise 4</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/clipboard-1.7.1/clipboard.min.js"></script>
<link href="site_libs/primer-tooltips-1.4.0/build.css" rel="stylesheet" />
<link href="site_libs/klippy-0.0.0.9500/css/klippy.min.css" rel="stylesheet" />
<script src="site_libs/klippy-0.0.0.9500/js/klippy.min.js"></script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #0000ff; } /* Keyword */
code > span.ch { color: #008080; } /* Char */
code > span.st { color: #008080; } /* String */
code > span.co { color: #008000; } /* Comment */
code > span.ot { color: #ff4000; } /* Other */
code > span.al { color: #ff0000; } /* Alert */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #008000; font-weight: bold; } /* Warning */
code > span.cn { } /* Constant */
code > span.sc { color: #008080; } /* SpecialChar */
code > span.vs { color: #008080; } /* VerbatimString */
code > span.ss { color: #008080; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { } /* Variable */
code > span.cf { color: #0000ff; } /* ControlFlow */
code > span.op { } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #ff4000; } /* Preprocessor */
code > span.do { color: #008000; } /* Documentation */
code > span.an { color: #008000; } /* Annotation */
code > span.cv { color: #008000; } /* CommentVar */
code > span.at { } /* Attribute */
code > span.in { color: #008000; } /* Information */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' || rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="html-md-01.css" type="text/css" />

</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<div class="container-fluid main-container">

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->





<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Geographic Data Analysis</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="overview.html">Overview</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Topics
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Lecture topics</li>
    <li>
      <a href="lec01.html">Introduction to the course</a>
    </li>
    <li>
      <a href="lec02.html">Univariate plots</a>
    </li>
    <li>
      <a href="lec03.html">Bivariate plots</a>
    </li>
    <li>
      <a href="ggplot2.html">ggplot2 versions of basic plots</a>
    </li>
    <li>
      <a href="lec04.html">Descriptive statistics</a>
    </li>
    <li>
      <a href="lec05.html">Multivariate plots</a>
    </li>
    <li>
      <a href="lec06.html">Maps in R</a>
    </li>
    <li>
      <a href="lec07.html">Geospatial analysis in R</a>
    </li>
    <li>
      <a href="lec08.html">Data wrangling and matrix algebra</a>
    </li>
    <li>
      <a href="lec09.html">Reference distributions</a>
    </li>
    <li>
      <a href="lec10.html">Statistical inference</a>
    </li>
    <li>
      <a href="lec11.html">Analysis of variance</a>
    </li>
    <li>
      <a href="lec12.html">Regression analysis</a>
    </li>
    <li>
      <a href="lec13.html">More regression analysis</a>
    </li>
    <li>
      <a href="lec14.html">Nonparametric regression</a>
    </li>
    <li>
      <a href="lec15.html">GLMs, GAMs, and CARTs</a>
    </li>
    <li>
      <a href="lec16.html">Principal components and factor analyses</a>
    </li>
    <li>
      <a href="lec17.html">MANOVA and discriminant analysis</a>
    </li>
    <li>
      <a href="lec18.html">Multivariate distances and cluster analysis</a>
    </li>
    <li>
      <a href="lec19.html">High-resolution and high-dimension data</a>
    </li>
    <li>
      <a href="lec20.html">Analysis and visualization of large raster data sets</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Exercises &amp; Exams
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Exercises</li>
    <li>
      <a href="ex01.html">Exercise 01 -- Getting R and RStudio</a>
    </li>
    <li>
      <a href="ex02.html">Exercise 02 -- Univariate plots</a>
    </li>
    <li>
      <a href="ex03.html">Exercise 03 -- Bivariate plots and descriptive statistics</a>
    </li>
    <li>
      <a href="ex04.html">Exercise 04 -- Multivariate plots</a>
    </li>
    <li>
      <a href="ex05.html">Exercise 05 -- Data wrangling and matrix algebra</a>
    </li>
    <li>
      <a href="ex06.html">Exercise 06 -- CI's, t-tests, ANOVA</a>
    </li>
    <li>
      <a href="ex07.html">Exercise 07 -- Regression analysis</a>
    </li>
    <li>
      <a href="ex08.html">Exercise 08 -- Multivariate analysis</a>
    </li>
    <li class="dropdown-header">Exams</li>
    <li>
      <a href="exam1.html">Exam 1</a>
    </li>
    <li>
      <a href="exam2.html">Exam 2</a>
    </li>
    <li class="dropdown-header">Other materials</li>
    <li>
      <a href="packages-and-data.html">Packages and Data</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Resources
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="readings.html">Readings</a>
    </li>
    <li>
      <a href="datasets.html">Datasets</a>
    </li>
    <li>
      <a href="oldpages.html">Old course web pages</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="about.html">About</a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Exercise 4</h1>

</div>


<script>
  addClassKlippyTo("pre.r, pre.markdown");
  addKlippy('right', 'top', 'auto', '1', 'Copy code', 'Copied!');
</script>
<p><strong>Geography 4/595: Geographic Data Analysis</strong><br />
<strong>Winter 2019</strong></p>
<p><strong>Exercise 4: Multivariate Plots</strong><br />
<strong>Finish by Monday, February 4th</strong></p>
<p><strong>1. Introduction</strong></p>
<p><strong>Read through the exercise before attempting to complete it.</strong></p>
<p>The purpose of this exercise is to explore some of the general multivariate plotting procedures available in R, including maps, multivariate plots in particular, conditioning plots (coplots), and Trellis/Lattice graphics. Before getting into the exercise, there are several set-up things to do that will facilitate completing this exercise and reproducing the examples in lectures.</p>
<p>This exercise uses a number of “R packages” or libraries of functions, data sets, etc. that must be downloaded and installed from “CRAN” (you will need to be connected to the Internet to do this). This can be done by following the instructions in <a href="https://pjbartlein.github.io/GeogDataAnalysis/packages-and-data.html">[Installing Packages and Workspaces]</a></p>
<p>Alternatively, in the Windows R Gui, there is a menu choice “Packages” that assists in downloading and installing packages, (see Packages &gt; Install package(s) from CRAN), and there is a similar feature on the Mac, and under the Tools menu in RStudio.</p>
<p>For this exercise, you’ll need to install the following packages:</p>
<p><code>rgeos</code>, <code>sp</code>, <code>maptools</code>, <code>classInt</code>, <code>RColorBrewer</code>, and <code>lattice</code>.</p>
<p>The easiest way to do this is to use the Package menu in Windows, the Packages &amp; Data menu on the Mac, or the Tools &gt; Install packages menu in RStudio but it may be more efficient to just repeatedly use the <code>install.packages()</code> function, for example:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">install.packages</span>(<span class="st">&quot;sp&quot;</span>)</code></pre></div>
<p>You can check to see if a package has been successfully downloaded and installed by attempting to load the package with the library() function, e.g.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(maptools)</code></pre></div>
<p>(NOTE: If an error message is produced e.g. <code>Error in library(maptools) : There is no package called 'maptools'</code> then the download and installation has failed. If that’s the case, packages may also be downloaded and installed using the command line in the R Gui, as follows:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">options</span>(<span class="dt">CRAN =</span> <span class="st">&quot;http://cran.us.r-project.org/&quot;</span>) <span class="co"># tell R where to look for packages</span>
<span class="kw">install.packages</span>(<span class="st">&quot;maptools&quot;</span>) <span class="co"># download and install the maptools package</span></code></pre></div>
<p>On Windows, you will get the following message: <code>--- Please select a CRAN mirror for use in this session ---</code> and a scrolling list box should open. It turns out that the closest repository to us is in Seattle and is the last one in the list, so scroll down and select it, and then click on “ok”. You can also use the Packages menu to choose the closest mirror. On the Mac, you can use the Package Manager and Package Installer to do the same.)</p>
<p>(NOTE: You don’t need to use the command line approach if you use the menu–just download the packages once, and you shouldn’t need to do either if you followed in the instructions in <a href="https://pjbartlein.github.io/GeogDataAnalysis/packages-and-data.html">[Installing Packages and Workspaces]</a>.)</p>
<p>Occasionally, it’s a good idea to check if packages have been updated; this can be done by typing.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">update.packages</span>()</code></pre></div>
<p>or using the menu, Packages &gt; Update packages from CRAN (Windows) or the R Package Installer (Mac, Packages &amp; Data &gt; R Package Installer). On Windows, the update may fail; see the workaround at the bottom of Part 5 of Exercise 1.</p>
<p>After downloading and installing, it’s ok to delete the installation files if prompted.</p>
<p>Further information can be found in the FAQs: <a href="http://cran.us.r-project.org/bin/windows/base/rw-FAQ.html">[Windows]</a> <a href="http://cran.us.r-project.org/doc/FAQ/R-FAQ.html">[General]</a> <a href="http://cran.us.r-project.org/bin/macosx/RMacOSX-FAQ.html">[Mac OS X]</a></p>
<p><strong>2. Simple maps</strong></p>
<p>Begin by constructing some simple maps of the Oregon climate-station data <a href="https://pjbartlein.github.io/GeogDataAnalysis/data/csv/orstationc.csv">[orstationc.csv]</a>. (See Section 2 of Exercise 3 for directions on how to download and save these data if they are no longer in your working directory.) Also, before starting, download and save in your working directory the following components of a shape file of Oregon county outlines:</p>
<p><a href="https://pjbartlein.github.io/GeogDataAnalysis/data/shp/orotl.shp">[orotl.shp]</a> <a href="https://pjbartlein.github.io/GeogDataAnalysis/data/shp/orotl.dbf">[orotl.dbf]</a> <a href="https://pjbartlein.github.io/GeogDataAnalysis/data/shp/orotl.shx">[orotl.shx]</a></p>
<p>You will find it most helpful to use a text editor or the script window in RStudio for this exercise, because you will want to reuse the code the get results for more than one variable. The internal script editors work fine (Windows: File &gt; New script; Mac: File &gt; New Document; RStudio File &gt; New File &gt; R Script), and TextEdit, Notepad or even Word will do the job.</p>
<p>WARNING: On the Mac GUI (as opposed to RStudio on the Mac), the internal script/document editor in R is smart enough to recognize formatted text, and R may object when you try to execute a script based to text copied in from a document or web page like this one (via Command-C, Command-Tab, Command-V), complaining about “unexpected input”, or simply not doing anything. To work around that, when you paste text in, hold down the Option key also to paste as unformatted text (i.e. Option-Command-V). If the text in the script editor appears to be formatted as courier-new, delete all of that formatted text and try pasting again. (Note that you can use the Apple menu &gt; System Preferences &gt; Keyboard &gt; Keyboard Shortcut tab to redefine Command-V to paste as unformatted text only in R.app.)</p>
<p>In general, using RStudio would be the easiest approach for this exercise.</p>
<p>Mapping a single variable is accomplished by executing three blocks of R code:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Block 1:  set up -- do this once</span>
<span class="kw">library</span>(rgeos)
<span class="kw">library</span>(maptools)
<span class="kw">library</span>(sp)
<span class="kw">library</span>(RColorBrewer)
<span class="kw">library</span>(classInt)

<span class="co"># read and attach climate data</span>
csvfile &lt;-<span class="st"> &quot;orstationc.csv&quot;</span> <span class="co"># assume the data file is in your working directory</span>
orstationc &lt;-<span class="st"> </span><span class="kw">read.csv</span>(csvfile) 
<span class="kw">attach</span>(orstationc)
<span class="co"># read a county outline shape file</span>
shapefile &lt;-<span class="st"> &quot;orotl.shp&quot;</span>
orotl.shp &lt;-<span class="st"> </span><span class="kw">readShapeLines</span>(shapefile, <span class="dt">proj4string=</span><span class="kw">CRS</span>(<span class="st">&quot;+proj=longlat&quot;</span>))</code></pre></div>
<p>Plot the outlines to check that the shape file has been read in correctly. You should see a map of Oregon:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(orotl.shp) <span class="co"># plot the outline</span></code></pre></div>
<p>Now the second block:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Block 2: set variable and get colors</span>
plotvar &lt;-<span class="st"> </span>pjan <span class="co"># pick a variable to plot</span>
plottitle &lt;-<span class="st"> &quot;January Precipitation&quot;</span>
nclr &lt;-<span class="st"> </span><span class="dv">8</span> <span class="co"># number of colors</span>
plotclr &lt;-<span class="st"> </span><span class="kw">brewer.pal</span>(nclr,<span class="st">&quot;PuBu&quot;</span>) <span class="co"># get nclr colors</span>

<span class="co"># find equal-frequency intervals</span>
class &lt;-<span class="st"> </span><span class="kw">classIntervals</span>(plotvar, nclr, <span class="dt">style=</span><span class="st">&quot;quantile&quot;</span>)
colcode &lt;-<span class="st"> </span><span class="kw">findColours</span>(class, plotclr)
cutpts &lt;-<span class="st"> </span><span class="kw">round</span>(class<span class="op">$</span>brks, <span class="dt">digits=</span><span class="dv">1</span>)
cutpts</code></pre></div>
<p>Nothing more will appear in the graphics window yet. This is still part of the set up. Print (by typing at the command line, or using the <code>print()</code> function (e.g. <code>print(plotvar)</code> the variables <code>plotvar</code>, <code>plotclr</code>, <code>colornum</code>, <code>brks</code> and <code>colorcode</code> to get an idea of what the above block of code does.</p>
<p>The third block of code makes a map:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Block 3: plot the shape file and the selected variable</span>
<span class="kw">plot</span>(orotl.shp)

<span class="co"># add points</span>
<span class="kw">points</span>(lon, lat, <span class="dt">pch=</span><span class="dv">16</span>, <span class="dt">col=</span>colcode, <span class="dt">cex=</span><span class="dv">2</span>)
<span class="kw">points</span>(lon, lat, <span class="dt">cex=</span><span class="dv">2</span>) <span class="co"># draws black line around each point</span>

<span class="co"># add legend</span>
<span class="kw">legend</span>(<span class="dt">x=</span><span class="op">-</span><span class="dv">118</span>, <span class="dt">y=</span><span class="fl">43.5</span>, <span class="dt">legend=</span><span class="kw">names</span>(<span class="kw">attr</span>(colcode, <span class="st">&quot;table&quot;</span>)),
    <span class="dt">fill=</span><span class="kw">attr</span>(colcode, <span class="st">&quot;palette&quot;</span>), <span class="dt">cex=</span><span class="fl">0.6</span>, <span class="dt">bty=</span><span class="st">&quot;n&quot;</span>)

<span class="co"># add the title</span>
<span class="kw">title</span>(plottitle)
<span class="co"># detach orstation</span>
<span class="kw">detach</span>(orstationc)</code></pre></div>
<p>The first block of code should be executed once. The five <code>library()</code> function calls load various packages. The <code>readShapeLines()</code> function from <code>maptools</code> reads in the shape file.</p>
<p>The second block of code sets (a) the variable to plot by assigning, in this case, <code>pan</code>n, to <code>plotvar</code> (remember you can discover the names of the variables in the data frame <code>orstationc</code> using the <code>names()</code> function), and (b) the number of colors to use. (To plot other variables, replace <code>pjan</code> in this example.) The remainder of this second block figures out which particular color to assign to each observation.</p>
<p>The third block of code plots the shapefile, adds color-coded points, and a legend. To generate a map of another variable, one would edit the second block of code, and then execute the second and third blocks, by cutting or pasting.</p>
<p>Construct maps for several of the climate variables (<code>pjan</code> and <code>tjul</code> in particular).</p>
<blockquote>
<p>Q1: Describe the basic patterns and gradients of winter precipitation and summer temperature across the state.</p>
</blockquote>
<p><strong>3. The coplot</strong></p>
<p>Coplots (or conditioning plots) are probably the most commonly used multipanel plot, and an easy-to-use function is available. The following code creates a coplot for annual temperature, plotted as a function of elevation, given latitude and longitude. Before executing the code, use search() to check to see that orstationc is still attached, and the lattice library is still loaded. If not they can be loaded and attached as follows</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(lattice)
<span class="kw">attach</span>(orstationc)</code></pre></div>
<p>Here’s the code for the coplot:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">coplot</span>(tann <span class="op">~</span><span class="st"> </span>elev <span class="op">|</span><span class="st"> </span>lon <span class="op">*</span><span class="st"> </span>lat, <span class="dt">number=</span><span class="dv">5</span>, <span class="dt">overlap=</span>.<span class="dv">5</span>,
    <span class="dt">panel=</span><span class="cf">function</span>(x,y,...) {
        <span class="kw">panel.smooth</span>(x,y,<span class="dt">span=</span>.<span class="dv">8</span>,<span class="dt">iter=</span><span class="dv">5</span>,...)
        <span class="kw">abline</span>(<span class="kw">lm</span>(y <span class="op">~</span><span class="st"> </span>x), <span class="dt">col=</span><span class="st">&quot;blue&quot;</span>)
    } 
 )</code></pre></div>
<p>(Be sure to include the trailing curvy bracket and parenthesis when copying and pasting.)</p>
<p><strong>NOTE</strong>: The current version of RStudio on the Mac (Version 1.1.463) may produce the error message “<code>Error in plot.new(): figure margins too large</code>” and not plot the “shingles” in the top and right-hand margins. If that happens, the workaround is to write the output to a file:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">pdf</span>(<span class="st">&quot;coplot.pdf&quot;</span>)
<span class="kw">coplot</span>(tann <span class="op">~</span><span class="st"> </span>elev <span class="op">|</span><span class="st"> </span>lon <span class="op">*</span><span class="st"> </span>lat, <span class="dt">number=</span><span class="dv">5</span>, <span class="dt">overlap=</span>.<span class="dv">5</span>,
  <span class="dt">panel=</span><span class="cf">function</span>(x,y,...) {
    <span class="kw">points</span>(x,y,...)
    <span class="kw">abline</span>(<span class="kw">lm</span>(y <span class="op">~</span><span class="st"> </span>x), <span class="dt">col=</span><span class="st">&quot;blue&quot;</span>)
  } 
)
<span class="kw">dev.off</span>()</code></pre></div>
<p>The <code>pdf(&quot;coplot.pdf&quot;)</code> function opens a file in your working directory called <code>coplot.pdf</code> and writes the plot into that file. The <code>dev.off()</code> function closes that file, and you can then view it using Acrobat or Preview.</p>
<p>Each panel on the diagram shows the relationship between annual average temperature and elevation for a geographical subset of data. The “panel functions” in <code>coplot()</code> allow lowess curves and least-squares lines to be added to the plot to facilitate interpretation. The individual panels, arranged as they are here, form a map of scatter diagrams.</p>
<blockquote>
<p>Q2: How do latitude and longitude influence the relationship between temperature and elevation? Is the relationship “stationary” across the state (i.e. same relationship everywhere), or are there spatial variations in the strength or form of the relationship.</p>
</blockquote>
<p>Experiment with the number of coplot shingles and degree of overlap of each (the number and overlap arguments in the coplot() function.</p>
<blockquote>
<p>Q3: How do these two parameters control the appearance of the resulting diagram?</p>
</blockquote>
<blockquote>
<p>Q4: What are the tradeoffs involved in changing the number of shingles. Is there a particular choice that seems to work better?</p>
</blockquote>
<p>Detach <code>orstationc</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">detach</span>(orstationc)</code></pre></div>
<p><strong>4. Lattice plots</strong></p>
<p>This set of plots and analyses use a data set of glacial-cirque locations in Oregon collected by Deb Sea several years ago for a class project. The data set may be found here: <a href="https://pjbartlein.github.io/GeogDataAnalysis/data/csv/cirques.csv">[cirques.csv]</a> and the data can be read into the R workspace after downloading as follows:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">csvfile &lt;-<span class="st"> &quot;cirques.csv&quot;</span>
cirques &lt;-<span class="st"> </span><span class="kw">read.csv</span>(csvfile)
<span class="kw">attach</span>(cirques)
<span class="kw">names</span>(cirques)</code></pre></div>
<p>The variables are an index number (<code>Cirque</code>), location (<code>Lat</code>, <code>Lon</code>), elevation in meters (<code>Elev</code>), a region indicator (which can be plotted to discover what the regions are; <code>Region</code>) and a 0/1 variable that indicates whether each cirque is occupied by a glacier (<code>Glacier = 1</code>) or not.</p>
<p>(Should you wish to also do nicer maps of these data, here are the links to the appropriate shapefile components: <a href="https://pjbartlein.github.io/GeogDataAnalysis/data/shp/cirques.dbf">[.dbf]</a> <a href="https://pjbartlein.github.io/GeogDataAnalysis/data/shp/cirques.shp">[.shp]</a> <a href="https://pjbartlein.github.io/GeogDataAnalysis/data/shp/cirques.shx">[.shx]</a>)</p>
<p>The aim of the analysis is to examine the spatial variations in the elevations of the cirque basins, in order to infer what might be controlling their distribution. From theory, we might expect that the “glaciation threshold” or elevation at which glaciers may form, should be lower where it is cooler and moister, and higher where it is warm and dry. The question that can be asked here is whether the Oregon cirque distributions conform to this idea, based on examining that distribution.</p>
<p>Load the Lattice package and change the default colors:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(lattice)
<span class="kw">trellis.device</span>(<span class="dt">color=</span><span class="ot">TRUE</span>, <span class="dt">theme =</span> <span class="st">&quot;col.whitebg&quot;</span>) <span class="co"># do on Windows and Mac applications</span></code></pre></div>
<p>(A gray-background graphics window will open, but nothing else happens. In RStudio, you won’t need to open a secondary plotting window.)</p>
<p>Produce a 3-D scatter plot of cirque elevation as a function of latitude and longitude, with the points colored by Glacier</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">cloud</span>(Elev <span class="op">~</span><span class="st"> </span>Lon<span class="op">*</span>Lat, <span class="dt">pch=</span><span class="dv">16</span>, <span class="dt">cex=</span><span class="fl">1.25</span>, <span class="dt">col=</span><span class="dv">1</span><span class="op">+</span><span class="kw">as.integer</span>(Glacier))</code></pre></div>
<p>The glaciated cirque basins should appear in red. Relative to all cirque basins, note where the glaciated ones tend to occur.</p>
<p>Create and plot some conditioning variables:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">Lat2 &lt;-<span class="st"> </span><span class="kw">equal.count</span>(Lat,<span class="dv">4</span>,.<span class="dv">5</span>)
Lon2 &lt;-<span class="st"> </span><span class="kw">equal.count</span>(Lon,<span class="dv">4</span>,.<span class="dv">5</span>)
<span class="kw">plot</span>(Lat2)
<span class="kw">plot</span>(Lon2)</code></pre></div>
<p>Using those conditioning variables, construct a Lattice-type coplot of elevation as a function of longitude, given (or condtioned by) latitude:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Cirque elevation as a function of longitude, given latitude</span>
plot2 &lt;-<span class="st"> </span><span class="kw">xyplot</span>(Elev <span class="op">~</span><span class="st"> </span>Lon <span class="op">|</span><span class="st"> </span>Lat2,
    <span class="dt">layout =</span> <span class="kw">c</span>(<span class="dv">4</span>, <span class="dv">2</span>),
    <span class="dt">panel =</span> <span class="cf">function</span>(x, y) {
        <span class="kw">panel.grid</span>(<span class="dt">v=</span><span class="dv">2</span>)
        <span class="kw">panel.xyplot</span>(x, y)
        <span class="kw">panel.loess</span>(x, y, <span class="dt">span =</span> .<span class="dv">8</span>, <span class="dt">degree =</span> <span class="dv">1</span>, <span class="dt">family=</span><span class="st">&quot;gaussian&quot;</span>)
        <span class="kw">panel.abline</span>(<span class="kw">lm</span>(y<span class="op">~</span>x))
    },
    <span class="dt">xlab =</span> <span class="st">&quot;Longitude&quot;</span>,
    <span class="dt">ylab =</span> <span class="st">&quot;Elevation (m)&quot;</span>
)
<span class="kw">print</span>(plot2)</code></pre></div>
<p>The title bar of each panel is shaded to indicate (by means of the darker shading) the particular range of latitudes of the points that are plotted on each panel. The leftmost panel contains the observations from the lowest latitude band, while the rightmost contains those from the highest latitude band.</p>
<p>Note that the two lines/curves added to the plot (a lowess/loess curve and a straight-line plot) are meant to summarize the relationship within each scatter plot panel, if there is a relationship to be summarized. In other words, the curves may not appear to fit the data very well at all, which is useful to know. In other cases, the curves may help to reveal a relationship that would otherwise be difficult to see. You can eliminate the curves by removing the panel functions panel.xyplot(etc.) and panel.abline(etc.)</p>
<p>Edit the above code, to create a coplot for elevation as a function of latitude, conditioned by longitude. The most convenient way to do this is to copy and past the block of code into a text editor, make the changes, and the copy and paste then result into R.</p>
<blockquote>
<p>Q5: Describe the relationships. (How do cirque elevations vary across the state? Do the relationships conform to the conceptual model described above?)</p>
</blockquote>
<p>Produce two other kinds of Trellis plots</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Lattice stripplot</span>
plot4 &lt;-<span class="st"> </span><span class="kw">stripplot</span>(Glacier <span class="op">~</span><span class="st"> </span>Elev <span class="op">|</span><span class="st"> </span>Lat2<span class="op">*</span>Lon2)
<span class="kw">print</span>(plot4)

<span class="co"># Lattice boxplot</span>
plot5 &lt;-<span class="st"> </span><span class="kw">bwplot</span>(Glacier <span class="op">~</span><span class="st"> </span>Elev<span class="op">|</span><span class="st"> </span>Lat2<span class="op">*</span>Lon2)
<span class="kw">print</span>(plot5)</code></pre></div>
<p>Note that on these plots, the unglaciated cirque basins (Glacier = 0) in the data set will be labeled “1”, while the glaciated basins (Glacier = 1) in the data set, will be labeled “2” (i.e. the first and second levels of the variable Glacier).</p>
<blockquote>
<p>Q6: Do the additional plots contribute anything to understanding the distribution of cirque elevations?</p>
</blockquote>
<blockquote>
<p>Q7: Describe the distribution of cirques across the state, and suggest what might influence that distribution. It might make sense to take a look at some maps of the climate variables.</p>
</blockquote>
<blockquote>
<p>Q8: Overall, would you say that cirque elevations vary with latitude, longitude and elevation each acting independently, or are there interactions among those controls?</p>
</blockquote>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
